!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@iota/iota.js"),require("big-integer")):"function"==typeof define&&define.amd?define(["@iota/iota.js","big-integer"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).mam=t(e.Iota,e.bigInt)}(this,(function(e,t){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=r(e),s=r(t),o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var l={},a={},u={},c={},d={};Object.defineProperty(d,"__esModule",{value:!0}),d.TextHelper=void 0;d.TextHelper=class{static encodeNonASCII(e){return"string"==typeof e?e.replace(/[\u007F-\uFFFF]/g,(e=>`\\u${`0000${e.charCodeAt(0).toString(16)}`.slice(-4)}`)):void 0}static decodeNonASCII(e){return"string"==typeof e?e.replace(/\\u(\w{4})/gi,((e,t)=>String.fromCharCode(Number.parseInt(t,16)))):void 0}},Object.defineProperty(c,"__esModule",{value:!0}),c.TrytesHelper=void 0;const f=n.default,h=d;class T{static isHash(e){return/^[9A-Z]{81}$/.test(e)}static isTag(e){return/^[9A-Z]{27}$/.test(e)}static isTrytes(e){return/^[9A-Z]+$/.test(e)}static toTrits(e){const t=new Int8Array(3*e.length);for(let r=0;r<e.length;r++){const n=T.ALPHABET.indexOf(e.charAt(r));t[3*r]=T.TRYTES_TRITS[n][0],t[3*r+1]=T.TRYTES_TRITS[n][1],t[3*r+2]=T.TRYTES_TRITS[n][2]}return t}static fromTrits(e){let t="";for(let r=0;r<e.length;r+=3)for(let n=0;n<T.ALPHABET.length;n++)if(T.TRYTES_TRITS[n][0]===e[r]&&T.TRYTES_TRITS[n][1]===e[r+1]&&T.TRYTES_TRITS[n][2]===e[r+2]){t+=T.ALPHABET.charAt(n);break}return t}static tritsValue(e){let t=0;for(let r=e.length-1;r>=0;r--)t=3*t+e[r];return t}static fromAscii(e){let t="";for(let r=0;r<e.length;r++){const n=e.charCodeAt(r),s=n%27,o=(n-s)/27;t+=T.ALPHABET[s]+T.ALPHABET[o]}return t}static toAscii(e){const t=e;if(t.length%2==1)throw new Error("The trytes length must be an even number");let r="";for(let e=0;e<t.length;e+=2){const n=T.ALPHABET.indexOf(t[e])+27*T.ALPHABET.indexOf(t[e+1]);r+=String.fromCharCode(n)}return r}static objectToTrytes(e){const t=JSON.stringify(e),r=h.TextHelper.encodeNonASCII(t);return r?T.fromAscii(r):""}static objectFromTrytes(e){if("string"!=typeof e)throw new TypeError("fromTrytes can only convert strings");const t=e.replace(/\9+$/,"");if(0===t.length)throw new Error("fromTrytes trytes does not contain any data");const r=T.toAscii(t),n=h.TextHelper.decodeNonASCII(r);return n?JSON.parse(n):void 0}static stringToTrytes(e){const t=h.TextHelper.encodeNonASCII(e);return t?T.fromAscii(t):""}static stringFromTrytes(e){let t=e.replace(/\9+$/,"");t.length%2==1&&(t+="9");const r=T.toAscii(t);return h.TextHelper.decodeNonASCII(r)}static packTrytes(e){const t=[];for(const r of e)t.push(T.ALPHABET.indexOf(r).toString(2).padStart(5,"0"));let r=t.join("");const n=r.length%8;return n>0&&(r+="1".repeat(8-n)),f.Converter.binaryToBytes(r)}static unpackTrytes(e){const t=f.Converter.bytesToBinary(e),r=[];for(let e=0;e<t.length;e+=5){const n=t.slice(e,e+5);if(n.length<5||"111111"===n)break;r.push(T.ALPHABET[Number.parseInt(n,2)])}return r.join("")}}c.TrytesHelper=T,T.ALPHABET="9ABCDEFGHIJKLMNOPQRSTUVWXYZ",T.TRYTES_TRITS=[new Int8Array([0,0,0]),new Int8Array([1,0,0]),new Int8Array([-1,1,0]),new Int8Array([0,1,0]),new Int8Array([1,1,0]),new Int8Array([-1,-1,1]),new Int8Array([0,-1,1]),new Int8Array([1,-1,1]),new Int8Array([-1,0,1]),new Int8Array([0,0,1]),new Int8Array([1,0,1]),new Int8Array([-1,1,1]),new Int8Array([0,1,1]),new Int8Array([1,1,1]),new Int8Array([-1,-1,-1]),new Int8Array([0,-1,-1]),new Int8Array([1,-1,-1]),new Int8Array([-1,0,-1]),new Int8Array([0,0,-1]),new Int8Array([1,0,-1]),new Int8Array([-1,1,-1]),new Int8Array([0,1,-1]),new Int8Array([1,1,-1]),new Int8Array([-1,-1,0]),new Int8Array([0,-1,0]),new Int8Array([1,-1,0]),new Int8Array([-1,0,0])];var H={},y={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.digestFromSignature=e.checksumSecurity=e.signature=e.privateKeyFromSubseed=e.address=e.digestFromSubseed=e.subseed=e.PRIVATE_KEY_FRAGMENT_LENGTH=void 0;const t=n.default;e.PRIVATE_KEY_FRAGMENT_LENGTH=27*t.Curl.HASH_LENGTH;e.subseed=function(e,r){const n=new t.Curl(27),s=e.slice();let o=r;for(;o-- >0;)for(let e=0;e<s.length&&s[e]++>=1;e++)s[e]=-1;n.absorb(s,0,s.length);const i=new Int8Array(t.Curl.HASH_LENGTH);return n.squeeze(i,0,i.length),i},e.digestFromSubseed=function(r,n){const s=new t.Curl(27),o=new t.Curl(27),i=new t.Curl(27),l=n*e.PRIVATE_KEY_FRAGMENT_LENGTH/t.Curl.HASH_LENGTH,a=new Int8Array(t.Curl.HASH_LENGTH);s.absorb(r,0,r.length);for(let e=0;e<l;e++){s.squeeze(a,0,a.length);for(let e=0;e<27;e++)o.reset(),o.absorb(a,0,a.length),o.squeeze(a,0,a.length);i.absorb(a,0,a.length)}return i.squeeze(a,0,a.length),a},e.address=function(e){const r=new t.Curl(27);r.absorb(e,0,e.length);const n=new Int8Array(t.Curl.HASH_LENGTH);return r.squeeze(n,0,n.length),n},e.privateKeyFromSubseed=function(r,n){const s=n*e.PRIVATE_KEY_FRAGMENT_LENGTH,o=new Int8Array(s),i=new Int8Array(s),l=new t.Curl(27);l.absorb(r,0,r.length),l.squeeze(o,0,o.length);for(let e=0;e<s/t.Curl.HASH_LENGTH;e++){const r=e*t.Curl.HASH_LENGTH;l.reset(),l.absorb(o,r,t.Curl.HASH_LENGTH),i.set(l.rate(),r)}return i},e.signature=function(e,r){const n=new Int8Array(r.length),s=new t.Curl(27);for(let o=0;o<r.length/t.Curl.HASH_LENGTH;o++){let i=r.subarray(o*t.Curl.HASH_LENGTH,(o+1)*t.Curl.HASH_LENGTH);for(let t=0;t<13-(e[3*o]+3*e[3*o+1]+9*e[3*o+2]);t++)s.reset(),s.absorb(i,0,i.length),i=s.rate();n.set(i,o*t.Curl.HASH_LENGTH)}return n},e.checksumSecurity=function(e){const r=e.slice(0,t.Curl.HASH_LENGTH/3);let n=0;for(let e=0;e<r.length;e++)n+=r[e];if(0===n)return 1;const s=e.slice(0,2*t.Curl.HASH_LENGTH/3);let o=0;for(let e=0;e<s.length;e++)o+=s[e];if(0===o)return 2;let i=0;for(let t=0;t<e.length;t++)i+=e[t];return 0===i?3:0},e.digestFromSignature=function(e,r){const n=new t.Curl(27),s=new Int8Array(r.length);for(let o=0;o<r.length/t.Curl.HASH_LENGTH;o++){let i=r.slice(o*t.Curl.HASH_LENGTH,(o+1)*t.Curl.HASH_LENGTH);for(let t=0;t<e[3*o]+3*e[3*o+1]+9*e[3*o+2]- -13;t++)n.reset(),n.absorb(i,0,i.length),i=n.rate();s.set(i,o*t.Curl.HASH_LENGTH)}return n.reset(),n.absorb(s,0,s.length),n.rate()}}(y),Object.defineProperty(H,"__esModule",{value:!0}),H.generateAddress=void 0;const g=y;H.generateAddress=function(e,t,r){const n=g.subseed(e,t),s=g.digestFromSubseed(n,r);return{address:g.address(s),privateKey:g.privateKeyFromSubseed(n,r)}};var A={};Object.defineProperty(A,"__esModule",{value:!0}),A.MerkleNode=void 0;A.MerkleNode=class{constructor(e,t,r,n){this.left=e,this.right=t,this.size=(e?e.size:0)+(t?t.size:0),this.addressTrits=r,this.privateKeyTrits=n}},Object.defineProperty(u,"__esModule",{value:!0}),u.MerkleTree=void 0;const p=n.default,_=c,b=H,w=A;u.MerkleTree=class{constructor(e,t,r,n){const s=_.TrytesHelper.toTrits(e),o=[];for(let e=0;e<r;e++){const r=b.generateAddress(s,t+e,n);o.push(new w.MerkleNode(void 0,void 0,r.address,r.privateKey)),o[e].size=1}this.root=this.buildTree(o)}static root(e,t,r){const n=new p.Curl(27);let s=1;const o=Math.ceil(t.length/p.Curl.HASH_LENGTH);for(let i=0;i<o;i++){const o=t.slice(i*p.Curl.HASH_LENGTH,(i+1)*p.Curl.HASH_LENGTH);n.reset(),0==(s&r)?(n.absorb(e,0,e.length),n.absorb(o,0,o.length)):(n.absorb(o,0,o.length),n.absorb(e,0,e.length)),s<<=1,e=n.rate()}return n.rate()}getSubtree(e){var t;if(1===this.root.size)return{key:(null===(t=this.root.left)||void 0===t?void 0:t.privateKeyTrits)?this.root.left.privateKeyTrits:new Int8Array,leaves:[]};const r=[];let n,s=this.root,o=this.root.size;if(e<o)for(;s;){if(!s.left){n=s.privateKeyTrits;break}o=s.left.size,e<o?(r.push(s.right?s.right:s.left),s=s.left):(r.push(s.left),s=s.right,e-=o)}return r.reverse(),{key:null!=n?n:new Int8Array,leaves:r}}buildTree(e){const t=[];for(let r=0;r<e.length;r+=2){const n=e[r],s=r+1<e.length?e[r+1]:void 0;let o;if(s){const e=new p.Curl(27);e.absorb(n.addressTrits,0,n.addressTrits.length),e.absorb(s.addressTrits,0,s.addressTrits.length),o=new Int8Array(p.Curl.HASH_LENGTH),e.squeeze(o,0,o.length)}else o=n.addressTrits;t.push(new w.MerkleNode(n,s,o,void 0))}return 1===t.length?t[0]:this.buildTree(t)}};var E={},v={};Object.defineProperty(v,"__esModule",{value:!0}),v.roundThird=v.pascalDecode=v.pascalEncode=void 0;const m=c,S=new Int8Array([1,0,0,-1]);function F(e){const t=e%3;return 0===t?e:e+3-t}function I(e,t){return e<=t?1:1+I(e,1+3*t)}function C(e){return m.TrytesHelper.tritsValue(e.slice(0,3))>0?3:3+C(e.slice(3))}function N(e,t){const r=L(e,t,0);if(e>=0)return r;for(let e=0;e<t.length;e++)t[e]=-t[e];return r}function L(e,t,r){switch(e){case 0:return 0;default:let n=Math.floor(e/3),s=e%3;return s>1&&(n+=1,s=-1),t[r]=s,1+L(n,t,++r)}}v.pascalEncode=function(e){if(0===e)return S;const t=F(I(Math.abs(e),1)),r=new Int8Array(function(e){const t=F(I(Math.abs(e),1));return t+t/3}(e));N(e,r);let n=0,s=0;for(let e=0;e<t-3;e+=3){const t=r.slice(e,e+3);if(m.TrytesHelper.tritsValue(t)>=0){n|=1<<s;for(let n=0;n<t.length;n++)r[e+n]=-t[n]}s++}const o=r.slice(t-3,t-3+t);if(m.TrytesHelper.tritsValue(o)<0){n|=1<<s;for(let e=0;e<o.length;e++)r[e+t-3]=-r[e+t-3]}const i=new Int8Array(r.length-t);N(n,i);for(let e=0;e<i.length;e++)r[t+e]=i[e];return r},v.pascalDecode=function(e){if(e.length>=S.length&&e[0]===S[0]&&e[1]===S[1]&&e[2]===S[2]&&e[3]===S[3])return{value:0,end:4};const t=C(e),r=t+t/3,n=m.TrytesHelper.tritsValue(e.slice(t,r));let s=0;for(let r=0;r<t/3;r++){const t=0!=(n>>r&1)?-m.TrytesHelper.tritsValue(e.slice(3*r,3*(r+1))):m.TrytesHelper.tritsValue(e.slice(3*r,3*(r+1)));s+=Math.pow(27,r)*t}return{value:s,end:r}},v.roundThird=F;var M=o&&o.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(E,"__esModule",{value:!0}),E.HammingDiver=void 0;const G=n.default,O=M(s.default),k=v;class P{search(e,t,r,n){const s=this.prepareTrits(e,n);let o=Math.min(r,G.Curl.HASH_LENGTH)-n,i=0;for(;0===i;){const e=this.increment(s,n+2*o/3,n+o);o=Math.min(k.roundThird(n+2*o/3+e),G.Curl.HASH_LENGTH)-n;const r={low:s.low.slice(),high:s.high.slice()};this.transform(r),i=this.check(t,r.low,r.high)}return this.trinaryGet(s.low,s.high,o,i)}prepareTrits(e,t){const r=this.tritsToBigInt(e,G.Curl.STATE_LENGTH);return r.low[t]=P.LOW_0,r.low[t+1]=P.LOW_1,r.low[t+2]=P.LOW_2,r.low[t+3]=P.LOW_3,r.high[t]=P.HIGH_0,r.high[t+1]=P.HIGH_1,r.high[t+2]=P.HIGH_2,r.high[t+3]=P.HIGH_3,r}tritsToBigInt(e,t){const r={low:[],high:[]};for(let t=0;t<e.length;t++)switch(e[t]){case 0:r.low[t]=P.MAX_VALUE,r.high[t]=P.MAX_VALUE;break;case 1:r.low[t]=P.MIN_VALUE,r.high[t]=P.MAX_VALUE;break;default:r.low[t]=P.MAX_VALUE,r.high[t]=P.MIN_VALUE}if(e.length>=t)return r;for(let n=e.length;n<t;n++)r.low[n]=P.MAX_VALUE,r.high[n]=P.MAX_VALUE;return r}increment(e,t,r){for(let n=t;n<r;n++){const s=e.low[n],o=e.high[n];if(e.low[n]=o.xor(s),e.high[n]=s,o.and(s.not()).equals(0))return r-t}return r-t+1}transform(e){let t=0;for(let r=0;r<P.ROUNDS;r++){const r={low:e.low.slice(0,G.Curl.STATE_LENGTH),high:e.high.slice(0,G.Curl.STATE_LENGTH)};for(let n=0;n<G.Curl.STATE_LENGTH;n++){const s=r.low[t],o=r.high[t];t+=t<365?364:-365;const i=r.high[t],l=r.low[t].xor(o),a=this.bitWiseNot(i),u=s.or(a).and(l);e.low[n]=this.bitWiseNot(u);const c=s.xor(i);e.high[n]=c.or(u)}}}bitWiseNot(e){return O.default(1).shiftLeft(64).subtract(O.default(1)).subtract(e)}check(e,t,r){for(let n=0;n<64;n++){let s=0;for(let o=0;o<e;o++){for(let e=243*o/3;e<243*(o+1)/3;e++){const o=O.default(1).shiftLeft(n);t[e].and(o).equals(0)?s--:r[e].and(o).equals(0)&&s++}if(0===s&&o<e-1){s=1;break}}if(0===s)return n}return 0}trinaryGet(e,t,r,n){const s=new Int8Array(r);for(let o=0;o<r;o++){const r=O.default(n),i=e[o].shiftRight(r).and(1),l=t[o].shiftRight(r).and(1);i.equals(1)&&l.equals(0)?s[o]=-1:i.equals(0)&&l.equals(1)?s[o]=1:s[o]=0}return s}}E.HammingDiver=P,P.MAX_VALUE=O.default("FFFFFFFFFFFFFFFF",16),P.MIN_VALUE=O.default("0000000000000000",16),P.HIGH_0=O.default("B6DB6DB6DB6DB6DB",16),P.HIGH_1=O.default("8FC7E3F1F8FC7E3F",16),P.HIGH_2=O.default("FFC01FFFF803FFFF",16),P.HIGH_3=O.default("003FFFFFFFFFFFFF",16),P.LOW_0=O.default("DB6DB6DB6DB6DB6D",16),P.LOW_1=O.default("F1F8FC7E3F1F8FC7",16),P.LOW_2=O.default("7FFFE00FFFFC01FF",16),P.LOW_3=O.default("FFC0000007FFFFFF",16),P.ROUNDS=27;var R={};Object.defineProperty(R,"__esModule",{value:!0}),R.concatenate=void 0,R.concatenate=function(e){let t=0;for(const r of e)t+=r.length;const r=new Int8Array(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return r};var x={};Object.defineProperty(x,"__esModule",{value:!0}),x.validateModeKey=void 0;const j=c;x.validateModeKey=function(e,t){if("public"!==e&&"private"!==e&&"restricted"!==e)throw new Error(`The mode must be public, private or restricted, it is '${e}'`);if("restricted"===e){if(!t)throw new Error("You must provide a sideKey for restricted mode");if(!j.TrytesHelper.isTrytes(t))throw new Error("The sideKey must be in trytes");if(t.length>81)throw new Error("The sideKey must be maximum length 81 trytes")}if("restricted"!==e&&t)throw new Error("sideKey is only used in restricted mode")};var B={};Object.defineProperty(B,"__esModule",{value:!0}),B.unmask=B.mask=B.maskHash=void 0;const K=n.default;function D(e,t){const r=e+t;switch(r){case 2:return-1;case-2:return 1;default:return r}}B.maskHash=function(e){const t=new K.Curl(81);t.absorb(e,0,e.length);const r=new Int8Array(K.Curl.HASH_LENGTH);return t.squeeze(r,0,r.length),r},B.mask=function(e,t){const r=t.rate(),n=Math.ceil(e.length/K.Curl.HASH_LENGTH);for(let s=0;s<n;s++){const n=e.slice(s*K.Curl.HASH_LENGTH,(s+1)*K.Curl.HASH_LENGTH);t.absorb(n,0,n.length);const o=t.rate();for(let t=0;t<n.length;t++)e[s*K.Curl.HASH_LENGTH+t]=D(n[t],r[t]),r[t]=o[t]}return e},B.unmask=function(e,t){const r=new Int8Array(e),n=Math.ceil(r.length/K.Curl.HASH_LENGTH)*K.Curl.HASH_LENGTH;let s;for(let e=0;e<n;e++){const n=e%K.Curl.HASH_LENGTH;0===n&&(s=t.rate()),s&&(r[e]=D(r[e],-s[n])),n===K.Curl.HASH_LENGTH-1&&t.absorb(r,Math.floor(e/K.Curl.HASH_LENGTH)*K.Curl.HASH_LENGTH,K.Curl.HASH_LENGTH)}return r},Object.defineProperty(a,"__esModule",{value:!0}),a.createMessage=a.channelRoot=a.createChannel=void 0;const V=n.default,Y=u,q=E,z=y,U=R,W=x,X=B,$=v,Z=c;a.createChannel=function(e,t,r,n){if(!Z.TrytesHelper.isHash(e))throw new Error("The seed must be 81 trytes long");if(t<1||t>3)throw new Error(`Security must be between 1 and 3, it is ${t}`);return W.validateModeKey(r,n),{seed:e,mode:r,sideKey:"restricted"===r?(null!=n?n:"").padEnd(81,"9"):void 0,security:t,start:0,count:1,nextCount:1,index:0}},a.channelRoot=function(e){if(!e)throw new Error("channelState must be provided");if(e.start<0)throw new Error("channelState.start must be >= 0");if(e.count<=0)throw new Error("channelState.count must be > 0");if(e.security<1||e.security>3)throw new Error(`channelState.security must be between 1 and 3, it is ${e.security}`);const t=new Y.MerkleTree(e.seed,e.start,e.count,e.security);return Z.TrytesHelper.fromTrits(t.root.addressTrits)},a.createMessage=function(e,t){var r;if(!Z.TrytesHelper.isTrytes(t))throw new Error("The message must be in trytes");const n=new Y.MerkleTree(e.seed,e.start,e.count,e.security),s=new Y.MerkleTree(e.seed,e.start+e.count,e.nextCount,e.security).root.addressTrits,o=Z.TrytesHelper.toTrits(t),i=$.pascalEncode(e.index),l=$.pascalEncode(o.length),a=n.getSubtree(e.index),u=new V.Curl(27),c=Z.TrytesHelper.toTrits(null!==(r=e.sideKey)&&void 0!==r?r:"9".repeat(81));u.absorb(c,0,c.length),u.absorb(n.root.addressTrits,0,n.root.addressTrits.length);let d=U.concatenate([i,l]);u.absorb(d,0,d.length);const f=X.mask(U.concatenate([s,o]),u);d=U.concatenate([d,f]);const h=(new q.HammingDiver).search(u.rate(V.Curl.STATE_LENGTH),e.security,V.Curl.HASH_LENGTH/3,0);X.mask(h,u),d=U.concatenate([d,h]);const T=z.signature(u.rate(),a.key),H=U.concatenate(a.leaves.map((e=>e.addressTrits))),y=H.length/V.Curl.HASH_LENGTH,g=X.mask(U.concatenate([T,$.pascalEncode(y),H]),u);d=U.concatenate([d,g]);const A=d.length%3;0!==A&&(d=U.concatenate([d,new Int8Array(3-A).fill(0)]));const p="public"===e.mode?n.root.addressTrits:X.maskHash(n.root.addressTrits),_={payload:Z.TrytesHelper.fromTrits(d),root:Z.TrytesHelper.fromTrits(n.root.addressTrits),address:Z.TrytesHelper.fromTrits(p)};return e.index===e.count-1?(e.start=e.nextCount+e.start,e.index=0):e.index++,e.nextRoot=Z.TrytesHelper.fromTrits(s),_};var J={},Q={};Object.defineProperty(Q,"__esModule",{value:!0}),Q.parseMessage=void 0;const ee=n.default,te=u,re=y,ne=B,se=v,oe=c;Q.parseMessage=function(e,t,r){const n=oe.TrytesHelper.toTrits(e),s=oe.TrytesHelper.toTrits(t),o=oe.TrytesHelper.toTrits(null!=r?r:"9".repeat(81)),i=se.pascalDecode(n),l=i.value,a=se.pascalDecode(n.slice(i.end)),u=a.value,c=i.end+a.end,d=c+ee.Curl.HASH_LENGTH,f=d+u,h=new ee.Curl(27);h.absorb(o,0,o.length),h.absorb(s,0,s.length),h.absorb(n,0,c);const T=ne.unmask(n.slice(c,c+ee.Curl.HASH_LENGTH),h),H=ne.unmask(n.slice(d,d+u),h),y=ne.unmask(n.slice(f,f+ee.Curl.HASH_LENGTH/3),h),g=h.rate(),A=re.checksumSecurity(g);if(0===A)throw new Error("Message Hash did not have a hamming weight of zero, security level is invalid");const p=ne.unmask(n.slice(f+y.length),h);h.reset();const _=p.slice(0,A*re.PRIVATE_KEY_FRAGMENT_LENGTH),b=re.digestFromSignature(g,_);h.absorb(b,0,b.length);const w=se.pascalDecode(p.slice(A*re.PRIVATE_KEY_FRAGMENT_LENGTH)),E=w.value;let v=h.rate();if(0!==E){const e=A*re.PRIVATE_KEY_FRAGMENT_LENGTH+w.end,t=p.slice(e,e+E*ee.Curl.HASH_LENGTH);v=te.MerkleTree.root(v,t,l)}if(oe.TrytesHelper.fromTrits(v)!==t)throw new Error("Signature did not match expected root");return{nextRoot:oe.TrytesHelper.fromTrits(T),message:oe.TrytesHelper.fromTrits(H)}};var ie=o&&o.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,o){function i(e){try{a(n.next(e))}catch(e){o(e)}}function l(e){try{a(n.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,l)}a((n=n.apply(e,t||[])).next())}))};Object.defineProperty(J,"__esModule",{value:!0}),J.decodeMessages=J.mamFetchAll=J.decodeAddress=J.mamFetch=J.mamAttach=void 0;const le=n.default,ae=x,ue=B,ce=c,de=Q;function fe(e,t,r,n){return ie(this,void 0,void 0,(function*(){ae.validateModeKey(r,n);const s="string"==typeof e?new le.SingleNodeClient(e):e,o=he(t,r),i=le.Blake2b.sum256(le.Converter.utf8ToBytes(o));try{const e=yield s.messagesFind(i),r=[];for(const t of e.messageIds)try{const e=yield s.message(t);r.push(e)}catch(e){}return yield Te(r,t,n)}catch(e){}}))}function he(e,t){return"public"===t?e:ce.TrytesHelper.fromTrits(ue.maskHash(ce.TrytesHelper.toTrits(e)))}function Te(e,t,r){var n;return ie(this,void 0,void 0,(function*(){if(e&&0!==e.length)for(const s of e)if((null===(n=s.payload)||void 0===n?void 0:n.type)===le.INDEXATION_PAYLOAD_TYPE&&s.payload.data){const e=le.Converter.hexToBytes(s.payload.data);if(e.length>100){const n=e[0],s=n>0?e.slice(1,1+n):void 0,o=e.slice(1+n),i=s?ce.TrytesHelper.unpackTrytes(s):"",l=ce.TrytesHelper.unpackTrytes(o);try{const e=de.parseMessage(l,t,r);return Object.assign(Object.assign({root:t},e),{tag:i})}catch(e){}}}}))}J.mamAttach=function(e,t,r){return ie(this,void 0,void 0,(function*(){if(void 0!==r&&"string"!=typeof r)throw new Error("MWM and depth are no longer needed when calling mamAttach");if((r?r.length:0)>27)throw new Error("The tag length is too long");const n=r?ce.TrytesHelper.packTrytes(r):void 0,s=n?n.length:0,o=ce.TrytesHelper.packTrytes(t.payload),i=new Uint8Array(1+s+o.length);i[0]=s,n&&i.set(n,1),i.set(o,1+s);const l=le.Blake2b.sum256(le.Converter.utf8ToBytes(t.address)),a={payload:{type:le.INDEXATION_PAYLOAD_TYPE,index:le.Converter.bytesToHex(l),data:le.Converter.bytesToHex(i)}},u="string"==typeof e?new le.SingleNodeClient(e):e;return{message:a,messageId:yield u.messageSubmit(a)}}))},J.mamFetch=fe,J.decodeAddress=he,J.mamFetchAll=function(e,t,r,n,s){return ie(this,void 0,void 0,(function*(){const o="string"==typeof e?new le.SingleNodeClient(e):e;ae.validateModeKey(r,n);const i=void 0===s?Number.MAX_VALUE:s,l=[];let a=t;do{const e=yield fe(o,a,r,n);e?(l.push(e),a=e.nextRoot):a=void 0}while(a&&l.length<i);return l}))},J.decodeMessages=Te;var He={};Object.defineProperty(He,"__esModule",{value:!0});var ye={};Object.defineProperty(ye,"__esModule",{value:!0});var ge={};Object.defineProperty(ge,"__esModule",{value:!0});var Ae={};return Object.defineProperty(Ae,"__esModule",{value:!0}),function(e){var t=o&&o.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),r=o&&o.__exportStar||function(e,r){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(r,n)||t(r,e,n)};Object.defineProperty(e,"__esModule",{value:!0}),r(a,e),r(J,e),r(Q,e),r(He,e),r(ye,e),r(ge,e),r(Ae,e),r(c,e)}(l),i(l)}));