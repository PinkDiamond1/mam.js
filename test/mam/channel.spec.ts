import { channelRoot, createChannel, createMessage } from "../../src/mam/channel";

test("createChannel() fails with empty seed", () => {
    expect(() => createChannel(<never>undefined, 0, <never>undefined)).toThrow("The seed");
});

test("createChannel() fails with invalid seed", () => {
    expect(() => createChannel("aaa", 0, <never>undefined)).toThrow("The seed");
});

test("createChannel() fails with security level too low", () => {
    expect(() => createChannel("A".repeat(81), 0, <never>undefined)).toThrow("Security must");
});

test("createChannel() fails with security level too high", () => {
    expect(() => createChannel("A".repeat(81), 4, <never>undefined)).toThrow("Security must");
});

test("createChannel() fails invalid mode", () => {
    expect(() => createChannel("A".repeat(81), 1, <never>"foo")).toThrow("The mode");
});

test("createChannel() fails restricted mode and no sidekey", () => {
    expect(() => createChannel("A".repeat(81), 3, "restricted")).toThrow("sideKey for restricted");
});

test("createChannel() fails restricted mode and invalid sidekey", () => {
    expect(() => createChannel("A".repeat(81), 3, "restricted", "foo")).toThrow("The sideKey");
});

test("createChannel() fails restricted mode and sidekey too long", () => {
    expect(() => createChannel("A".repeat(81), 3, "restricted", "S".repeat(82))).toThrow("maximum length");
});

test("createChannel() fails with non restricted mode and sidekey", () => {
    expect(() => createChannel("A".repeat(81), 3, "public", "S".repeat(82))).toThrow("sideKey is only");
});

test("createChannel() succeed with public mode", () => {
    const ch = createChannel("A".repeat(81), 1, "public");
    expect(ch.seed).toBe("A".repeat(81));
    expect(ch.mode).toBe("public");
    expect(ch.sideKey).toBe(undefined);
    expect(ch.security).toBe(1);
    expect(ch.start).toBe(0);
    expect(ch.count).toBe(1);
    expect(ch.nextRoot).toBe(undefined);
    expect(ch.nextCount).toBe(1);
    expect(ch.index).toBe(0);
});

test("createChannel() succeed with private mode", () => {
    expect(createChannel("A".repeat(81), 2, "private").seed).toBe("A".repeat(81));
});

test("createChannel() succeed with restricted mode", () => {
    const res = createChannel("A".repeat(81), 3, "restricted", "S".repeat(81));
    expect(res.seed).toBe("A".repeat(81));
    expect(res.sideKey).toBe("S".repeat(81));
});

test("createChannel() succeed with restricted mode and short sideKey", () => {
    const res = createChannel("A".repeat(81), 3, "restricted", "S".repeat(50));
    expect(res.seed).toBe("A".repeat(81));
    expect(res.sideKey).toBe(`${"S".repeat(50)}${"9".repeat(31)}`);
});

test("channelRoot() returns correct root for state in public mode", () => {
    const channel = createChannel("A".repeat(81), 2, "public");
    const root = channelRoot(channel);
    expect(root).toBe("POKRBFTSZPVUNXQAUMLXTVQOTIUBDWFTCIJOROUOGCQKVLHGQQABFPBXTL9RKUSHOLONFXTDWAHMDDJRG");
});

test("channelRoot() returns correct root for state in private mode", () => {
    const channel = createChannel("A".repeat(81), 2, "private");
    const root = channelRoot(channel);
    expect(root).toBe("POKRBFTSZPVUNXQAUMLXTVQOTIUBDWFTCIJOROUOGCQKVLHGQQABFPBXTL9RKUSHOLONFXTDWAHMDDJRG");
});

test("channelRoot() returns correct root for state in restricted mode", () => {
    const channel = createChannel("A".repeat(81), 2, "restricted", "S".repeat(81));
    const root = channelRoot(channel);
    expect(root).toBe("POKRBFTSZPVUNXQAUMLXTVQOTIUBDWFTCIJOROUOGCQKVLHGQQABFPBXTL9RKUSHOLONFXTDWAHMDDJRG");
});

test("createMessage() fails when message is not trytes", () => {
    const channel = createChannel("A".repeat(81), 2, "restricted", "S".repeat(81));
    expect(() => createMessage(channel, "foo")).toThrow("in trytes");
});

test("createMessage() returns correct message for state in public mode", () => {
    const channel = createChannel("A".repeat(81), 2, "public");
    const res = createMessage(channel, "FOO");
    expect(res.address).toBe("POKRBFTSZPVUNXQAUMLXTVQOTIUBDWFTCIJOROUOGCQKVLHGQQABFPBXTL9RKUSHOLONFXTDWAHMDDJRG");
    expect(res.root).toBe("POKRBFTSZPVUNXQAUMLXTVQOTIUBDWFTCIJOROUOGCQKVLHGQQABFPBXTL9RKUSHOLONFXTDWAHMDDJRG");
    expect(res.payload).toBe("AZSBBOOEMBUYSKPQGBFZ9PJPEFYHEMZERZWXTLSFHEHRBTTTHKEPULPOFPPZVJ9RCLPYCCKRUHCAMUCNDGYDZDPBQQWZIYNTBLZVPDRPZEJBKQQXFYDPQBSDXKJEEQHBAFLOJAUDHTTOQFNURNCUNMTGKPBMOGVSNPK9HHNGBYOGHZZJEZLEZNNOLAXJRSXYOMTMLFPFAQNWAJJMIMZANTNRXZWWAONKUYVOJWRUWXQERQJGIJDBFFOTNWJ9ABMBKFUHTGYINGYJSCVXANJDHAKYNZNCTQWDZ9JKJCHELICAAKODABXL9ZVWCYLISMEWV9HOITRTWVNNPPCWEJKUBKMQIAILLLZQMJRJRSUTIVZYEFSXJMTJYBKOFBDQRBCPVFTQFIXYKMCTPJ9BDBDXERYMENOLMMRHNXUDJBFBUNFKYIJOTMTUKGQOWPUYLNB9ZGYMQQDMLJMRKLFXEMRVHUAAAMTTOCJWECWBEUEQHNUBZDTFGIQDIVKWCYZLSRUSLVAICN9TUUJPSNIQJBPDNKGF9T9DWWOVHQUYBFDJZQVIHIYFANXMKSKWDLJBQRSIG9JHA9LOIQG9VQZKJKZMPAVSZNRGEFGYHTRBOGXZHXFVGSIKPOSAIPDAULYYQCCDXBWVBMDKZGQQSRLVDJPEBSFBLTKZFHDFGJKSCGCKMAKYXGTIXDBOZDFJGRAVIEJCHGJWDAHFUTGLCNLLJTPSHCZAOCBYSREYAHJVRDTSSGEVSYFRXSHTLZFDETGLNSBBUKAVVTVMWADKXS9TDVXBYMLLQOHRUV9SX9PDBSUPHANGZEYVVMTYSWUFFVDBJCHPLTBEEVSOWTRNNTIILKHMATKXLFW9BGVSHLFQFKY9IUALGBBVSIZYATPDQHYVVKAVBOMUFMQJMRIPZZMTDYXWOPVJB9KVFGFXUCNWMXDPPVJTZBVXVHPVPCGMEKYWSANVQFZSTQG9JXTPLQVWRSEFWOPFCXPYJWCNUTGEQOYOEQIW9IYG9AGSDMTLVJJWWNWJJDBAWPYYCOXZLDYBFIQPXTORSRCFRRTT9WSFBECUUXNPTGXY9ZGLCCDMMI9BYLCZXXJKHFIOODLGRRFLGTNZLZWL9WZFJZESUZKPADIPPYLJJFXQZKQBSAL9MGQBYKTZHXNYFFLCINAEMCWIHUKPCJBMKSCM99QVSXEIOBZWGISFRJJZELAHWDLPCGRW9ZQIPE9VUGHGJSDSLXWZVD9UBEREGWPHXZZWYMHFXL9V99QIRZMBKTNWYHDVXHQWXUOOGRPALITOUHPLBYBNTHVXOKCHZK9UFMJYC9CEPMLLYYBA9YGSZALRLBGGSXYLRWRZUFIJWYJ9MHLDXOQZCVEHDKPIXFISMELC9RGRQJQAKWCBG9DYGAAYHH9JRNJOOSBVQUUIEIOYNYBCIQJEPMEXVL9QCIGILXDCJCQRKXRJELLPMGF9PVGSLEURLT9VRZFCBOABBXYRDNBLBPEOOUHDXPDAUHCCZJXZVGLDKLE99YC99JUBXFWFULLWJTDUUVMDA9HMBUSDDORRPHNPLKCMAMLVM9QDVJ9BUZJSKOBGGJZVEEFEOUHBOQXDZXZMDSWRILVKINTZNRDRROAKGEKAKFMMTSQA9NDSTZCLFASORJPLZQXDGPHYNZSMXD9JIWTZAKSEHVPEWEI9RMODPCJGWKVAHMSVHJGGTCWVUDHPRUCDC9CAGJQWOXJTSNZVMGCSECNNLZHOAZOVLAOMJAUHHBOEVPOQRDRGPVCPWZQOSMCDLYZJZWHSKUGAQUYTKEPCJLQQEXAXN9QTOMSNETXLCBTDGQDEHLHBXTAOSZYTZVMEXFEJUFYRIFPPPMY9TR9TKLZZL9CBVZIPLNH9OFBTM9AOHPITXPPZASEAHDFDDFXSTBZFGJAOQQFFTINGEMUJVCWHHFVPQBJKOTDSUKEJNHEVUIHKGNOBTGKOAUUQMGIZPHCQGGTYSIQKOMFUHXRFYWLJVIXYRAKPQQ9TXLPGAQPKFQPXYXNGNPLATTZKZKNBHKNTO9GGDCYTKKPAPYOEBDTMSUDHFHDDDSFZNNAXWVMEXG9AUBYLPMOBWIXNVLZOLEYXOGVDVRJHAGCAKWH9AWAEBUMILLEVOYYTPHHHRSUKROWXAHMEPBDHIOJLFCOLQLILTNZUMAGQR9KYX9NYYJPLCWFXCZXRAJGJ9PICAFEISWVOWUWRXARFIUPOXDRUKQVMXNSNKLYYUIYYFCGUFTSHDKHULGYPGUBSPKPLWIW9SQQAGFEZARDEWQTHD9NGJYQQTT9GIKQBRH9QCGLSLHJRJHIQWQNOFAITTMFMCKVUGLEDJRDDCCCZEHUCDL9FMKJMNIKBQRZDHUHDDDDQDBBCVBVNEXCWKPCWRSVUFMZYEZDHHEFFXKNMBEJNHXINCLLYVNKSVCYFTQDRBNYPTZKXYFPELUTADFI9MPYSW9EOWDWYSQWDZNX9ESQCOANWZVVUUXAGOCQNISQOOTIVXWEQODDHVVMLZUWGXCEYYXRYXHSHHOPFXZMCBCTSJXMP9HTC9MVB9JZPTXYBDARQGIVRAALKZCADLELYXDFGDRT9K9RNUKHFGVSNWXETRSOKTHBDJRRFOAJECRWZBJREFJRKKCZCYNXGUNGKNCAQQUWCIPRSIQNTTUKYUGQJFIENJHWNSPGWCFCXUFAICUJ9OYRQOGAPUJZXVZ9EERKGSEGVYESQ9AHYXXWVUYKDSGATYHFYAHUN9YFMNYWRZUEHVGSVWMIETMIACRQGXUFIPNJ9EDLQXNSUTNZUYMEGIEWMQLQHDRBUNPMFDOMYQULQZNIJTD99KYKEAWFEHAFAOVYXKPELTWZRDVOKKPQDSTLOCCKUJZKVONBUTECZTSFJOOZUFBAOCGUYTRANCQCEWEXCSKVERTRCTGEQUADOZFBJ9CNTWAHBGKCVFXJJMGPRXHPZZXQQF9RRAVBIADHOLQQOXWWPU9FXGJFJKPTSAIJYQBOIXWBTNTNFNWDJOUQEUREZZKYA9XQPYHDRJLSCRV9SIHMOFGNHTXEOCXNGINPDCSMUDKNMMUJRGRUOZZDRBICKFPKJDTXNVSHKGPWHQIUEZTIORA9QAOBEQLZYSUFGGYFHYBRWNSPATVDIFO9TNVKQADIQE9KVOSVCK9MFHDCOKCYYAOSKAJITJIOV9BAQUFNFFOCMDFVBB9COJEAUGOBDBF9BEWCJMUGBVOSAYP9PYXKAOCNHJMQCIWOMSXHALPNVKMOEKW9MWDTGIPKVSDUXBUWZJEFCMUCCHCHECBTOTUIAO9WXNSMZVJOJVONQJDPSESPHKLW9NCNMPPLHZBHPBSRVVDSKIBTZFLNPPS9XLKFGVCW9PDBAERITTGIWMDTIPHBKHEKHYNDPJZWVKWQSJWMYCVP9ILXSMU9WPHYTSTXKKYAZNKUBJRFGFZYMCSWGHZESQPMACGMIKVVQKQPJXHXERBNHODHMEECZNEHEHFKCDRCYPUXVBIIDPAKCUTLPTQNAJWFDAOEQRLCCWTYQXSDIDQWPUTDDUCTUXWXZXYKRAPFEEDLY9TZFOFFYMCSKSSHWEDZLAUDS9FTKYCKGOELFFJLRXYEHVDTO9FKPUAROFSSZWYWBLOTFSUIBBTQHNEJLYAUSPVNHPBPPRRDTWYDJKJXGMZBAIAWV9APXTUHLXTTVKUQEMYDAYKBKMPBRCWEQAUQXZIUNMKYCVORBEOIOETZG9POL9BQXTHZLQYPZEHDSQGBQAGKMLPJAQ9KTFZNLJXISDPZCIOERWQX9KKXVFSNGYJASTNXPGLHJPBMWZMZB9OOILWTZVXQSXNYEKEE9XOEPEXRFLEEMDMGXCWKRETJWPDRHOEIDYNFLVDYG9XDQIICLEQFBBY9AMDSJOYBCIKOXXPCAFVPSJMJLJRZQKEMCIAFOH9DRROIWRJENXLCFWVZSGHRAPCBWVZP9UHUIEPPEQQZP9BKPHDJDOVHCZFHOGASISNJNHJCGKXKNXVDMLRBROTIYLV9YKPHALPVWJIQFBMSTBSDULAZKT9LJDTZISKVUTKPEVWCGUMMQDBEIWDBSLGOGUJYUOQIDDH9RGLGVCGSEUOANFUJLDWACKMPBNEVG9EJONZQHORAKBYILYIZOJDVKOUYKJIAUMGHTU9VWTGHCUJZIOXETKKLXBJZUZKCENU9MZQDCYRAJTDSQVZ9GTM99HSCZMCCVYIRBLENPDUGMVXTOQZRMBNKFDMGXXYRCVMHVUWVQTQKE9KROHDU9HOYRYUWU9XOHPSYQRMKFCJ9EAOHNWC9SXDESIKVFJTJGNWYAHNKGIAOJAGKWJBHYCA9ZMKRXVUKRCQANJJGZUKDKQHGI9GHJGQU9KZIZKSWHCPMTLBOLHXUUFJLYOMXQUMICAGE9QGSVEJKHPQNIKZ9HASUCZKZ9AXWH9NVRFXCHESKUCSDUAEWJ9CXPBL9YHNFZTEYSCRCZFHOKPMGUYJ9CEUPIJLROCIKHX");
    expect(channel.nextRoot).toBe("ZRBYGMGPEUBFOUMKULUBNCSQQNRH9JOMV9QJEZTAA99HCXLDHFTFOR9UYRKXSEYDRWPSDZQHJIFODHXRS");
    expect(channel.index).toBe(0);
});

test("createMessage() returns correct message for state in private mode", () => {
    const channel = createChannel("A".repeat(81), 2, "private");
    const res = createMessage(channel, "FOO");
    expect(res.address).toBe("RZTBC9CAUJGWMI9HXQPMKAESQYTEVQLBIMXGNWNZSMYLCXLBA9FDFJVVCKZTZD9PV9LGMAKBONWRXKJEN");
    expect(res.root).toBe("POKRBFTSZPVUNXQAUMLXTVQOTIUBDWFTCIJOROUOGCQKVLHGQQABFPBXTL9RKUSHOLONFXTDWAHMDDJRG");
    expect(res.payload).toBe("AZSBBOOEMBUYSKPQGBFZ9PJPEFYHEMZERZWXTLSFHEHRBTTTHKEPULPOFPPZVJ9RCLPYCCKRUHCAMUCNDGYDZDPBQQWZIYNTBLZVPDRPZEJBKQQXFYDPQBSDXKJEEQHBAFLOJAUDHTTOQFNURNCUNMTGKPBMOGVSNPK9HHNGBYOGHZZJEZLEZNNOLAXJRSXYOMTMLFPFAQNWAJJMIMZANTNRXZWWAONKUYVOJWRUWXQERQJGIJDBFFOTNWJ9ABMBKFUHTGYINGYJSCVXANJDHAKYNZNCTQWDZ9JKJCHELICAAKODABXL9ZVWCYLISMEWV9HOITRTWVNNPPCWEJKUBKMQIAILLLZQMJRJRSUTIVZYEFSXJMTJYBKOFBDQRBCPVFTQFIXYKMCTPJ9BDBDXERYMENOLMMRHNXUDJBFBUNFKYIJOTMTUKGQOWPUYLNB9ZGYMQQDMLJMRKLFXEMRVHUAAAMTTOCJWECWBEUEQHNUBZDTFGIQDIVKWCYZLSRUSLVAICN9TUUJPSNIQJBPDNKGF9T9DWWOVHQUYBFDJZQVIHIYFANXMKSKWDLJBQRSIG9JHA9LOIQG9VQZKJKZMPAVSZNRGEFGYHTRBOGXZHXFVGSIKPOSAIPDAULYYQCCDXBWVBMDKZGQQSRLVDJPEBSFBLTKZFHDFGJKSCGCKMAKYXGTIXDBOZDFJGRAVIEJCHGJWDAHFUTGLCNLLJTPSHCZAOCBYSREYAHJVRDTSSGEVSYFRXSHTLZFDETGLNSBBUKAVVTVMWADKXS9TDVXBYMLLQOHRUV9SX9PDBSUPHANGZEYVVMTYSWUFFVDBJCHPLTBEEVSOWTRNNTIILKHMATKXLFW9BGVSHLFQFKY9IUALGBBVSIZYATPDQHYVVKAVBOMUFMQJMRIPZZMTDYXWOPVJB9KVFGFXUCNWMXDPPVJTZBVXVHPVPCGMEKYWSANVQFZSTQG9JXTPLQVWRSEFWOPFCXPYJWCNUTGEQOYOEQIW9IYG9AGSDMTLVJJWWNWJJDBAWPYYCOXZLDYBFIQPXTORSRCFRRTT9WSFBECUUXNPTGXY9ZGLCCDMMI9BYLCZXXJKHFIOODLGRRFLGTNZLZWL9WZFJZESUZKPADIPPYLJJFXQZKQBSAL9MGQBYKTZHXNYFFLCINAEMCWIHUKPCJBMKSCM99QVSXEIOBZWGISFRJJZELAHWDLPCGRW9ZQIPE9VUGHGJSDSLXWZVD9UBEREGWPHXZZWYMHFXL9V99QIRZMBKTNWYHDVXHQWXUOOGRPALITOUHPLBYBNTHVXOKCHZK9UFMJYC9CEPMLLYYBA9YGSZALRLBGGSXYLRWRZUFIJWYJ9MHLDXOQZCVEHDKPIXFISMELC9RGRQJQAKWCBG9DYGAAYHH9JRNJOOSBVQUUIEIOYNYBCIQJEPMEXVL9QCIGILXDCJCQRKXRJELLPMGF9PVGSLEURLT9VRZFCBOABBXYRDNBLBPEOOUHDXPDAUHCCZJXZVGLDKLE99YC99JUBXFWFULLWJTDUUVMDA9HMBUSDDORRPHNPLKCMAMLVM9QDVJ9BUZJSKOBGGJZVEEFEOUHBOQXDZXZMDSWRILVKINTZNRDRROAKGEKAKFMMTSQA9NDSTZCLFASORJPLZQXDGPHYNZSMXD9JIWTZAKSEHVPEWEI9RMODPCJGWKVAHMSVHJGGTCWVUDHPRUCDC9CAGJQWOXJTSNZVMGCSECNNLZHOAZOVLAOMJAUHHBOEVPOQRDRGPVCPWZQOSMCDLYZJZWHSKUGAQUYTKEPCJLQQEXAXN9QTOMSNETXLCBTDGQDEHLHBXTAOSZYTZVMEXFEJUFYRIFPPPMY9TR9TKLZZL9CBVZIPLNH9OFBTM9AOHPITXPPZASEAHDFDDFXSTBZFGJAOQQFFTINGEMUJVCWHHFVPQBJKOTDSUKEJNHEVUIHKGNOBTGKOAUUQMGIZPHCQGGTYSIQKOMFUHXRFYWLJVIXYRAKPQQ9TXLPGAQPKFQPXYXNGNPLATTZKZKNBHKNTO9GGDCYTKKPAPYOEBDTMSUDHFHDDDSFZNNAXWVMEXG9AUBYLPMOBWIXNVLZOLEYXOGVDVRJHAGCAKWH9AWAEBUMILLEVOYYTPHHHRSUKROWXAHMEPBDHIOJLFCOLQLILTNZUMAGQR9KYX9NYYJPLCWFXCZXRAJGJ9PICAFEISWVOWUWRXARFIUPOXDRUKQVMXNSNKLYYUIYYFCGUFTSHDKHULGYPGUBSPKPLWIW9SQQAGFEZARDEWQTHD9NGJYQQTT9GIKQBRH9QCGLSLHJRJHIQWQNOFAITTMFMCKVUGLEDJRDDCCCZEHUCDL9FMKJMNIKBQRZDHUHDDDDQDBBCVBVNEXCWKPCWRSVUFMZYEZDHHEFFXKNMBEJNHXINCLLYVNKSVCYFTQDRBNYPTZKXYFPELUTADFI9MPYSW9EOWDWYSQWDZNX9ESQCOANWZVVUUXAGOCQNISQOOTIVXWEQODDHVVMLZUWGXCEYYXRYXHSHHOPFXZMCBCTSJXMP9HTC9MVB9JZPTXYBDARQGIVRAALKZCADLELYXDFGDRT9K9RNUKHFGVSNWXETRSOKTHBDJRRFOAJECRWZBJREFJRKKCZCYNXGUNGKNCAQQUWCIPRSIQNTTUKYUGQJFIENJHWNSPGWCFCXUFAICUJ9OYRQOGAPUJZXVZ9EERKGSEGVYESQ9AHYXXWVUYKDSGATYHFYAHUN9YFMNYWRZUEHVGSVWMIETMIACRQGXUFIPNJ9EDLQXNSUTNZUYMEGIEWMQLQHDRBUNPMFDOMYQULQZNIJTD99KYKEAWFEHAFAOVYXKPELTWZRDVOKKPQDSTLOCCKUJZKVONBUTECZTSFJOOZUFBAOCGUYTRANCQCEWEXCSKVERTRCTGEQUADOZFBJ9CNTWAHBGKCVFXJJMGPRXHPZZXQQF9RRAVBIADHOLQQOXWWPU9FXGJFJKPTSAIJYQBOIXWBTNTNFNWDJOUQEUREZZKYA9XQPYHDRJLSCRV9SIHMOFGNHTXEOCXNGINPDCSMUDKNMMUJRGRUOZZDRBICKFPKJDTXNVSHKGPWHQIUEZTIORA9QAOBEQLZYSUFGGYFHYBRWNSPATVDIFO9TNVKQADIQE9KVOSVCK9MFHDCOKCYYAOSKAJITJIOV9BAQUFNFFOCMDFVBB9COJEAUGOBDBF9BEWCJMUGBVOSAYP9PYXKAOCNHJMQCIWOMSXHALPNVKMOEKW9MWDTGIPKVSDUXBUWZJEFCMUCCHCHECBTOTUIAO9WXNSMZVJOJVONQJDPSESPHKLW9NCNMPPLHZBHPBSRVVDSKIBTZFLNPPS9XLKFGVCW9PDBAERITTGIWMDTIPHBKHEKHYNDPJZWVKWQSJWMYCVP9ILXSMU9WPHYTSTXKKYAZNKUBJRFGFZYMCSWGHZESQPMACGMIKVVQKQPJXHXERBNHODHMEECZNEHEHFKCDRCYPUXVBIIDPAKCUTLPTQNAJWFDAOEQRLCCWTYQXSDIDQWPUTDDUCTUXWXZXYKRAPFEEDLY9TZFOFFYMCSKSSHWEDZLAUDS9FTKYCKGOELFFJLRXYEHVDTO9FKPUAROFSSZWYWBLOTFSUIBBTQHNEJLYAUSPVNHPBPPRRDTWYDJKJXGMZBAIAWV9APXTUHLXTTVKUQEMYDAYKBKMPBRCWEQAUQXZIUNMKYCVORBEOIOETZG9POL9BQXTHZLQYPZEHDSQGBQAGKMLPJAQ9KTFZNLJXISDPZCIOERWQX9KKXVFSNGYJASTNXPGLHJPBMWZMZB9OOILWTZVXQSXNYEKEE9XOEPEXRFLEEMDMGXCWKRETJWPDRHOEIDYNFLVDYG9XDQIICLEQFBBY9AMDSJOYBCIKOXXPCAFVPSJMJLJRZQKEMCIAFOH9DRROIWRJENXLCFWVZSGHRAPCBWVZP9UHUIEPPEQQZP9BKPHDJDOVHCZFHOGASISNJNHJCGKXKNXVDMLRBROTIYLV9YKPHALPVWJIQFBMSTBSDULAZKT9LJDTZISKVUTKPEVWCGUMMQDBEIWDBSLGOGUJYUOQIDDH9RGLGVCGSEUOANFUJLDWACKMPBNEVG9EJONZQHORAKBYILYIZOJDVKOUYKJIAUMGHTU9VWTGHCUJZIOXETKKLXBJZUZKCENU9MZQDCYRAJTDSQVZ9GTM99HSCZMCCVYIRBLENPDUGMVXTOQZRMBNKFDMGXXYRCVMHVUWVQTQKE9KROHDU9HOYRYUWU9XOHPSYQRMKFCJ9EAOHNWC9SXDESIKVFJTJGNWYAHNKGIAOJAGKWJBHYCA9ZMKRXVUKRCQANJJGZUKDKQHGI9GHJGQU9KZIZKSWHCPMTLBOLHXUUFJLYOMXQUMICAGE9QGSVEJKHPQNIKZ9HASUCZKZ9AXWH9NVRFXCHESKUCSDUAEWJ9CXPBL9YHNFZTEYSCRCZFHOKPMGUYJ9CEUPIJLROCIKHX");
    expect(channel.nextRoot).toBe("ZRBYGMGPEUBFOUMKULUBNCSQQNRH9JOMV9QJEZTAA99HCXLDHFTFOR9UYRKXSEYDRWPSDZQHJIFODHXRS");
    expect(channel.index).toBe(0);
});

test("createMessage() returns correct message for state in restricted mode", () => {
    const channel = createChannel("A".repeat(81), 2, "restricted", "S".repeat(81));
    const res = createMessage(channel, "FOO");
    expect(res.address).toBe("RZTBC9CAUJGWMI9HXQPMKAESQYTEVQLBIMXGNWNZSMYLCXLBA9FDFJVVCKZTZD9PV9LGMAKBONWRXKJEN");
    expect(res.root).toBe("POKRBFTSZPVUNXQAUMLXTVQOTIUBDWFTCIJOROUOGCQKVLHGQQABFPBXTL9RKUSHOLONFXTDWAHMDDJRG");
    expect(res.payload).toBe("AZAQLTPQHGRBEFKRTGNMNNXKBFEZISMWTZ9YERMMXUQUMWUCUOUYVNTSXDCWBWKSV9RKPCYUWTPXWGHLMNTI9LPZYBOKODQQGHOFYHTKUQDEE9BZNXBDCPG99VZZP9GUK9CLBPHQVUPAAEDH9WRGRQGDIPUOMVAKPBWBTMWGBAIJANUWNJIMQCSKDEHEHSWVBRIQZCX9GJAUTEZGFWRDCQMUIYVCIPYPBZASKTBWYFOPHHOXVMDDGRYQRDHKLSJLGVJKFYZEFZJHLUWWQKUEUQQSHCAKYCSPOKTPAMXRXNRYWYAUDXMXFRLKGATXYKLPQTMOKTYCQLJEDOLTYNURZPMTYPHHBZRZDGVKRUVJVMYKNTQRJPIFOQ9ZRHN99CNSLEITDIQOIGCSZRTKNLMOUWOVRANCLUWGRCIEKJCQUOTXICWQZXGCKIHLZTGGXHW9MABFLVFEBBQDXJENXONDLNRYRUBDVLBQURHUZHCOVGKSDQGVDFTGAJDYLBFWUHVPSMWNJEIHQVFTTUBGM9SEDA9RPZXIVCFZHKIUGSAOAHFWWBPKFMBZKFSJMAFSOIPCNEHZBKWMDA9HXZTYHDHFJKXCFNXODZVCCFDOXXKQPHLJXS9UAWOWLZKNFMQVBMWUTBSQKSLZYWOCHPNU9AUIWMXECLJHWFMHWXDQPCTAKXECHGC9RYOTLCXKDAIZJLDTIHVSRY9LAHLWSXEWGLNIWRFDISVH9VCPUZEWXLWUB9JRWVGQYCNGAPOTOBRDRHHKRSB9HVBVGMYULLWDQNR9RVSIJDQLTBTDOVHMSFEGYKXGJSVVVVWPCCTNICCILCOHJDWUIMWGFWZGMXZLOIOLPAHEBS99QXZYSUTDIIRJDIQNEJKDUHJASGPORBTKHHYOLJATNNI9LGDZAEWVBLMAWUICDBUCCHKDSM9AZNNQRMRYNLWMZOROXPMNNNXAHYBZNSRWSDVGBKTWIGWJUKQICF9PNBLLJBLQTSYULMSCHJ9OCA9VJLUWHLIECWXBQWQXHMLLWCYLHGS9ZCBUADPKKVCVUZSKAZHTBQDKCOPNQRIFOSTZGDYZAKBPUQELV9MU9YISUYRHHLXJPSFOHSZGPPRXCB9LAZRSMGDYJZJIZTJPDLUGIMKKUBIDHFVQDVYWQOYHPJDUHCUPBBM9AFACFJIXSHGVJWYJTHKEBCLKMSYVXZEGJBHALGY9YEZSDMRFRXBEQSPQFZEYNKHDZJDVJCQLJTQGUSEDDOREXBTLHJ9Q9TFOGQXL9PAZCDXGGIJHEPAXBHCGOURMGJUODTDTEQKMK9KFTUVLAKABFYVJZEEHJIFWUYSUGHRFFDMECEVVJTUFQAUZYSWDCLCDRHXQ9JXCWKRQNJBWFUBWLRNR9RJQ9WKP9NHMFFVGLMQFWFVPHRFGZBEVAPBMOXRFNONUAW9RYYUQXYJYPAAEGLXSMYTHSXRTXVVMGQTUUOPGCXFLSEQUCSHWEGLAEIHXDENAVLHPPTLJRUBDIKGXHHYTAFTWNQKJASQFMCXIUKHBBQZQPSKTVBZATLQGKZROPUQJCJUYUESVEAVATOQAVLSWZSMCLWYPGAPOMGTNZEBWHHUTDUJOCCHYNTMJURKSL9DBPFZRBDOE9FPLFLHTWOVTRSS9FTLJBBHWCWAAGXEAKNUMRUXDNBPNKOMAYQTCGEDGGNKGZWAUGTWTQPPQSIAIV9AKXADLKTFZUWCRAOPAZHHSVE9JGMQYNPOWCKLGM9TIRZPZIJIBOZKMPJJPZTNLNIBOOWFHBU9OYYOGX9XZSSTXLLDCVJ9TUPLTJPDWMMQLJAFTJKLMKRQWMZHVTQTZHRDRTSPO9VSYVEEMBFPWUIQH9RNJMUPGIFQTGNRHXYHMUCRGPDNUXHYARQTLKDBPTZXEAYGYNGWVT99VHJQWAITQBZWNNZDLHLJMEDTHFHFKZZUADICCYSGPDJNHERJPS9PIYTSJFIRFYVVCZBNSPJNQQHORMOUFGY9QJQOFJEIBKFPLXDATWIPUQILODTRLOVWBOPNHJJMXKJQBQYK9JYSDKTECHQESULCXRTXJPTHCAKZBIVWRLVPNXXVLCLYIMAMLSEG9JRYPGERZTEPDTCIJYHVVYZHKYTRDCRJ9PZCGLAFYESVFBOWWTBJRKMWXJCCLW9MSYLDTGNCNPFUSLUIFQZZCRWEHNGBPCYKFRUGZKRFKPEABSEFCYYFDO9GQVPX9PPD9CDOWXPJCSUBDWCPFDUCKJTLMDVTASESYQNQNDUWTLHOR9FYAICHRYNZAJNSWTF9BSPGXWMEMZPEYKYHFDWPHA9IBHM9OCALVUZHNJJHJBZLJXY9FPITTSOLZHWMVYPHRPCVQRPWVFTRKOGEYFZIUEKDIXMCBXDVUDV9BBRRLNKXTPHYRCVWWF9XPQIOMYGZTFQTSFKHKWOZACEASUR9IG9TSIXAUSRKMQJYCDQLTCFZAGFG9FLUNKBLFGURDPYXRLJDHSTCHPATYGSJHMRSSPMTDPDODKIJLMOJIUOGHUZTOAXHPCJLEC9WXVWGDMQUKPMWZYVXKGZAX9CNOZFZQXSCNHU9SBGEHSEJOEXQATXVXTPZEDBGFOIAGIFUBQHCGJE9DJGEQPFBAFFMHZE9UBNBSCNHFTEDCHUNHJTFFXWPJDJSSMKBAICPZVJXDF9YRJHWWAMWEHDKHRE9O9QUMAECNMWECAYZUYZUWOWNAGRYUDXJCZBTCBKRVPCJIFFLFIFGLWTRQFZVSLF9EXE9NINIDQDLYRUBPAKRVIZNRLITOUJANPCBCEZLROJKUTBDFHRHKMHQXOK9RUMGPGADSUXRN9LXZVKWXGUS9TIUZYLJLTT9PSQSDGOWFMFDF9EULPNEKXBCTEJMGOKAXEXJKBLSVHMRNQZBWKTXJHSAISTZNUDCZTPBF9FZBLEIMSJYGMCZAQWSQHAWUPVIUYEKFJX9USFVVMAEFMMYFOMUGKCOSSVRXRYSGPDHAAIGNQDOOHZYODXRXIYZNZSWZ9RVFYLAGFKPYUMAMCPQQDKTNTATGSABRTNN9P99ZLUBETHBCEPYCRSZBIFENXHZK9NXTIDTWDSNJKJDJUPQLQTIYHEAWXGKHGBRUNBXZPUOHUX9BULTHAPDQFIMGPCKVNODZLAQLKBTUMXAOICMFRSXKMKJBHMOTKSVOEWBEDESWVXOWLZEXIESXUFVCUC9MBKZRYWEAFZDH9QQ9QJZYKITQAJKUEUZZPT9JOWBPQJQVLYAQZZMSFOWLWJFWGITCXHNRYQZGIKZLAP9ANAG9LLRGTMVEXRFSRIMBCZQELPBXLRP9TFKKFQUEQMCFYDGKUJ9H9VQKYBBPQRZKXAYJC9LCWVLSWJLFEJRBNHOTJTV99LLSYDEUODVUWQAKBDUXAKRJNYVBWKCYPSYEMCLKJLNMYZGJNEDXS9OFAAR9DS9JQXGNHHCSLDEDGUFRZGIFJVUOVCVSYYRPQNSHSXH9YASWFKIHJDPAHOHWNZQTSAXXIVIBMWACQZOL9DRTEXKUYGINILXTOHR9MWXUIDKOKNEDE9GREXAXLSRYKFFCRRCECKTANIUXABV9E9DOURUYUFHZRZEHRVMMJJIDOYUE9GVNKOLCBDTRINBUDAJNIAJDDFOPXMNUZYIUFOXFBOCVIHRLOLRBEBJJWMZJZTYUNLYUHWQFQUGMDOKXPKSNJEE9FIBZDTGYGEWWODZTYITYSWIHGYDKAAYXAXGNTDFHUOTDUIRJKH9QUJOFKMAMCC9QBOQGHMZWTTRNIZARUSOMWERIPXOMYEVWTPGUQLUWLGIPSJPMZPYRBSHMOQLWDEBVFUOQI9TYC9LZHBFGUJRTOLDSZATVYWUDTZAJBADEZTSDJTDBFFIYTQNKNIC9FXDN9OYLZXTDQGGFQSADC9CVIUAX9HPPKCJQGGSFDYBUJU9Y9RNHNPQCTNTDFBOBZFPOWQBGRLHKCSVPNWESACZLUEFDNQEULCCFLPAIJIMVDAETYKOLBNK99PZIEOCBTPHWKCPTHFPTHOZ99H9ZUYNYD9NBQKSLAKMTRYNOFYYXEKOYJEWHLPTOPMKWGKKDQ9LOKSXJSP9IVMZGCV9GPEPTWIZDEJDQVCXNQF9GWXRLPMHLJPXZJRZD9TLLRG9MLCTRHAKYPM9RISJPUXUMIFKCZEDUA9MCPSOKPUTDXQOZLIAFJ9DXAIPZC9BQOADXVFGY9XYSAQIFTOZHIWLCDGZJURASLYZGQXPHAXMPGCCEU9YOS9OMXBGWOPVYNLYZW9RMUAMZRYAHXETFRTYTUJVSCBFBWKCCBGAQXBFBYMFFDMLKJAFAQWOUIVWIKHRETNYOEMKJMYTJPZYJYBTV9HIIWAROWXUH9A9VVAFDIUCCYMVNAMABDVCCEMHGJWENIUQWCGVCVZEKFJELLHRFPPVSBIPS9JHHXMGYXQIFBUJJYTLOSGUMCPAXMF9FAIAWHEK9XLLVHUWKMKKJIFGGTFFWZFWKLBDHB");
    expect(channel.nextRoot).toBe("ZRBYGMGPEUBFOUMKULUBNCSQQNRH9JOMV9QJEZTAA99HCXLDHFTFOR9UYRKXSEYDRWPSDZQHJIFODHXRS");
    expect(channel.index).toBe(0);
});

test("createMessage() increments channel index when more count available", () => {
    const channel = createChannel("A".repeat(81), 2, "public");
    channel.index = 0;
    channel.count = 3;
    const res = createMessage(channel, "FOO");
    expect(res.address).toBe("VNRFAXW9XNHLYCFVJDLJVLTSOAWXUYUQMRSSYPQVQN9KKHVLSVAYAYJTDZKBNVSQXTCUNUFBAXSHNGLUI");
    expect(res.root).toBe("VNRFAXW9XNHLYCFVJDLJVLTSOAWXUYUQMRSSYPQVQN9KKHVLSVAYAYJTDZKBNVSQXTCUNUFBAXSHNGLUI");
    expect(res.payload).toBe("AZAMAFKQCYWDMG9TI9WID9IQLUPUGIZLKDQUZILBFAYQDDXEGQGUSBYMQEHPRKJDNBGLWQLNCWBVPOYWPHUHVTUJTQDCEHJSKFAJL99KFAXMNURMGDZITSRGW9MRMLYGEUZWOKSDAMXOFKYS9ZJ9WU9XOOUDFMMTHZUMXSDRXWSTWVZMWPRJFRDCNFUFWEAPCBTNIJWC9NVIL9ITREWJPPJKZDJLYPKRGOBPZFGPTPEKMMFCIFNHBG9L9HCTEVXLVVNATJOEFCQYLRKSRMTWPCZUPQYFJIOTDFMELOFNYECGHUDDIJHKMBNQVZWDQXEJSRVWASQRYRKRQSBPQUYIIVCKB9YYLEHRO9BE99CEBTBQMMYCYRQVYCPIPKCKOZGTUHHYZHRVZI9MIKTWNS9RMOLMHGYFUQ9TEE9VPUYMLJUU9DZHOCBQIYOH9GPPNDUROBHGQEGRJFQUWCEHBRRZINSALHFCZQOCTILJRFPZFDOW9WFLFZERIABWFOXNAXVSUCAFCIGBXZC9UMFQSCBCHNWWNPZCBQUVXSSYYLZGTFFTK9FGXR9TTENXUTAOC99LKKAFZL9ZRUWUYICOEBUKAYGTFNRLYBIIHYIYKBSFSMHSOEXTEEABPNAB9HBWQUJYRN9DOOZEHHTKDHIBBTKPUNTEJZYCNZZRAWDSGZXSRGSWBXJIUMGYQGGJCXRHADL9FLBWPKEMWD9IPAVHYGWZOHAUBOSKU9SIZUUYFDHWWVLHQKNZKVGQUIWIYEFFZHPLEKBJWCVFKRHFXCONKAXEMABYTCPTIRER9EZZESUWI9EPXDL9IYE9QY9QSIPLWJUGNQ9WHFRUXFRFYFJSPF9KWNOFMOKIYAWXTCCIEEUCAQTDARRRRLZWHXBDTVHXKWJULLWNRDMQKHPJRRKKCRGL9DITMWVSKIWDMRSOYPRZXGKYRBLCBDWCSIELHNKBFDFNOMJXEIZATUOP9NHDJEPPBNCOQMYBXXARQMSJZBUZQMVJDPHPFRCMYST9AONASA9CUFUKSLEIOIJIJERVVUYZYONDYCXSMRBOCYSLPHQAHFWRPMPLOCDOMOULTORULIWIDUHILXSWTSEKBITCSDBFHAKVTTH9UCFCGNXHOJQOIZ9VQKXJBWWMKENUDNUNPJXHNKVUYDUJSFHOWBGCLDXHIZSUHAM9LXO9OTWYPGTXMCZROXIKETTYWFGXVRI9MSBHPBMXTZ9VHRCYAQBRJODJIYRCBGVRERNCYVZQCAWBIRFKKL9CPZFNHKH9NEZUKEBYT9GELZMD9MY9GHNRDJXJQAVDCHEGWDMDTOCEYFONDBVLCYEDKVVXHOIUSA9JAMZDVRRHBINAIWHJXDRFOQRNBKYVPICJS9LNQOAFWAOTWPSACGCXDXNRLKMMNGVEQQLOCT9YCDEMLSZHSM9OOZZD9EPWMOQAQ9PUZTSIGNDDONUVDWTHVRY9CEKFDZADHJNZSDFZCLNZYZGKRDOAVTCJULCIXOXOQWAZLIEWLIZZUXVPM9VZDYQNYSUPZEGSUKHKURACFDGSAXYXWQVEWPAFSGLJXHPKV9QDRRZJ9KXZDVJHFISWQPLLDNLBJLLX9USUEGSH9DVKB9FGKJXC9LEQLETWJYMEMVPQWXRQPDFNITKQJZUGGBINZNT9FKRYVUMZGARPOPZFLPAECODGUERQEVHJFCWLHYMPARFHFENXRT9L9OHSFCJ99SAPRRJIVHNIYUQNIOUAQTO9GWHDBMWUAXZWLLUWOHFPCCTACOAWGCJAPRAMJETLCUK9ZRJHVRGIIQNF9HKEZRLZO9VCOPCAYLLBVBNKYZGBRXVVPWBB9UDIGCGUSLJLTBWCKNTGOYUMAJR9BHWQBUSRBFOUNQYKNAUAPGFVTBEEPUDRAEJTGMYOUIOUGODAFIURQOWHRXGQYOZWC9RFXAPAFJJCG9HWKEYISXLPUCGHXSRSIOKJEOSGPJQEPBRZJKBWBKXEIYMTCQJNUBYKIKZGUCZCLRUYQWQGPZGNNKQZSNBAOTAELUDWEIXNIONILDQJTEXMNPBYSZDFSYZNAZTCOOHRFUHJEMQBLTRBIONZABCWPGZLIDMQTLYTVRIHJDPGMPMHPRVNFHGYZKWEVPLGUASBTTEDLFCSSTTIAEAGHHNKMHFAQKAGZDRLQ9TNM9PUS9RMKFGXHDTKFVNJQXD9CNYKRMYFAWTDIYYVKGZOMUIIZAZDNPYGOW9XZFNCEOCMOCBVSGSTJUTQF9MAMWNRWMWHCLFCVXWASLMWPHYIRNHHQAJKLACPYJBMCBXU9QPLAYBBVFGHGGRGORIZXMNFQUFOLTVCFMVCOW9RZPCAUTTTGQHJOWI9INOJAVPJFAXLADHXOLPCJ9YYHTLCWJPWZJZYQWHGNJ9YBHIFYEMYHG9IIGTSWAPBDFQA9ZNZUQD9ITDTUOH9BSWCZENITQERB9RRPJNQWW9EX9XKNAZLLHOUCYCAHTLIPEHWFECHISILHEDVOXPWZBLKIPEDOWGWMJLZCXBOKPDFKDCNXVKCMJUWFKPXQKI9FWRDRLNGBWRYLMMYLBYSFLKGPTCZBQOHAJLDAKNENRIC9GQU9QHWSBMUWEUTHZNBHDEWYLNZGPZNASNSFGSWRDVXAWBOUCHNTEJU9IICMPF9X9NTBQEVCTIBZQYKQXPOCM9CIDDKCDQPLSQ9LYN9QYBWEKOUFQFLSGOQJCAABLBWKOHNUQYFBNF9ENJTGUKFOSNAT9BQ9NUMQRMYZAENZKQPIYIJCCWHEKNMRXVU9ECFOCMVIDNX9PIQDEDBECRDYFYTQNHWBQGNEJWYBKDJJVSEKIIMDGOSUIIDW9YFSAI9RCFXB9VJLVQUCQJZAAPAEWHYX9BPKPFFNMHZYXXNMEYJXFYCYPRH9MGFYUASKIQRHBDOCGIYGXNGKYXNURDJWQWSMQZYTT9FQFZKILARBUYSSXPUNLZGNACTTMDHSGTKHKD9TTSNMNXJHQGECEIDCOKPZJAEGNHWXTGYW9UXYAWDIV9RNLHXFAWXKNJYOTFNECQAUDAUVCZOPXOBE9TLXGDWKYMYKDWKDRCMHQIDUQGCHO9IZWAXXPTTBIKCZZKG9MRSVBYLLL9VRUBDHXYOLCGWVMZNGIIOYTKYSCFLBPAWPGNTBXOYZDNWCVEGGMSDISBXGCB99VIEBYBIGLVQAEQPWKZHJGLBHRAQNHBGKVCXWETKIF9RPQGZ9BN9QWCEZIIQOKCTN9ZTWQUYILYIIATIJSWLGGYEGWSACHABKAXDSFIYVWJCGCWCCGVNWLUNNVDHLIDOFPCVFVGVUUVCJUULQXLBP9QDQGYAHVYZMAMCEXLCXEGH9UTWUUHQAPFPMEYMRRRYXSEJQSTOZENWPQKDYJPMAAMALABWSTMTZGXBLPHGGENWNB9QOHCKTREZXPGRAVROVPNHEKHFHFDPZFTYHVBPSKDIQLLQP9YOZCVHCGMULYTIOTAYWESRNNGAHHVOQUDPPFZWHY9VFZSRBONMOI9GTWQDMWPTEEZMS9HYDHMZRUFNTAPYDIMKPQMCJQRFI9VAMCDTOZSGXSMCJVYECMGULBK9OIYHFPDSYPGC9GVNCDNAWRCMBVWJNACK9QA9EICFTVPRMAXRHNBETZECJANVEDFQJAQOEUWPTS9HGRUKGHFMG9FNQJFHEPFSJUCHXQTW9NPTEHUAFQPTNSVGGDRIZUIRTBXJZTVRKRRGYMNEQ9XWJIGRJXAQWAWONHZVHEDOLVHWVPPSYNUTUYDK9PUDWABWCWTYVEZXSVTQFBLZYV9SWKTOWRPZP9YGDFNZUXZYWOYHPD9PLTNJEVHOFJEYYHKMMAXOPSFJIOQZJPYAXQMFUYWONHUWEUYYAUFDZCRGUZVPXJWCQZVRSPBASXXN9IFURXBMOSBCEZYFKRSYUTBEP99FMEDAYHTNWCRI9YLDHTJQTZEOHOKRDXXDRUBNDYBTTEQKXIVSZLTKSOPLSMMCXNYGU9GYBGLBGGLGJFURKOWVWFAT9K9SCLT9TUDYEL9LWRULHCGPNSLKDQBZWNPPNQMRGCWBIYDXSFNZAWZUBYXSCGNSTWBUSITAWXVNDEROOXPHHVOMLOGWXMMNXGNVF9VRIZOMKTRJBYUYXDTAEPTWHNLMTPULXTDZWSTEOODDEBAJXXVNWRTUZNWWSOEQIDZK9ZKWT9JATYMUQZBJYVNA9FSSIIDIQMSDTSMGPLFW9TQEMGSYK9ZUCZMSBRRDLNUEDQFTB9AMPEFDEJFOMOTNYUUHUWEYMRPFBFBFOJBHAOOSJKNBPVJCWWMOUANVOCKRXBIJRWROMGCVJIREKCWZUJ9CXFFNDEMKANYICDIZAZKMEYOAPBT9DBRY9IIIQKFENHKUBSBKWRMCHDJFURROQOWLWTTIYIEO9WXJLFTNVNNWOVLRQIMXFACSEXORJNUUZMJHYJVPGUATPNTTDWBRWWDEBNGWQNYFKKPNCFBOAHELHKNRYJMTJTGCQGICW9OENEQEFBACTMHIUKLTVBQKNRGQRFKVSSMNNCIWGHWCVRISGBUQECRYQI9RBSCHXKSSBFUUFYKOUFYHLMROPSLZAOPHKLNROOCQMIFUSICTAFHWFPDXXMIGZMVD9XKWMATGXXNJOCPMINWF9LAQXTNLERWITVG");
    expect(channel.nextRoot).toBe("ZDTWARZZALNLTJAOHANKMCJIOZOYU9BER9OJXRVWPSIPBSKTROZBMYCLCSPWACZAI9OIJDTRHYNJZUHGI");
    expect(channel.start).toBe(0);
    expect(channel.index).toBe(1);
});

test("createMessage() calculates correct nextRoot on count size 1", () => {
    const channel = createChannel("A".repeat(81), 2, "public");
    createMessage(channel, "FOO");
    expect(channel.nextRoot).toBe("ZRBYGMGPEUBFOUMKULUBNCSQQNRH9JOMV9QJEZTAA99HCXLDHFTFOR9UYRKXSEYDRWPSDZQHJIFODHXRS");
    createMessage(channel, "FOO");
    expect(channel.nextRoot).toBe("FTYPWBXZMHASDQAEYGICKXBRDBRGXBPSVSG9OSQHPFWYNX9KFSYHBODGLRCWDBSUSWPDLNSVUYSYHJBXA");
    createMessage(channel, "FOO");
    expect(channel.nextRoot).toBe("ZDTWARZZALNLTJAOHANKMCJIOZOYU9BER9OJXRVWPSIPBSKTROZBMYCLCSPWACZAI9OIJDTRHYNJZUHGI");
});

test("createMessage() calculates correct nextRoot on count size 2", () => {
    const channel = createChannel("A".repeat(81), 2, "public");
    channel.count = 2;
    createMessage(channel, "FOO");
    expect(channel.nextRoot).toBe("FTYPWBXZMHASDQAEYGICKXBRDBRGXBPSVSG9OSQHPFWYNX9KFSYHBODGLRCWDBSUSWPDLNSVUYSYHJBXA");
    createMessage(channel, "FOO");
    expect(channel.nextRoot).toBe("FTYPWBXZMHASDQAEYGICKXBRDBRGXBPSVSG9OSQHPFWYNX9KFSYHBODGLRCWDBSUSWPDLNSVUYSYHJBXA");
    createMessage(channel, "FOO");
    expect(channel.nextRoot).toBe("ZDTWARZZALNLTJAOHANKMCJIOZOYU9BER9OJXRVWPSIPBSKTROZBMYCLCSPWACZAI9OIJDTRHYNJZUHGI");
});
