!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@iota/iota2.js"),require("big-integer")):"function"==typeof define&&define.amd?define(["@iota/iota2.js","big-integer"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).mam=t(e.iota2_js_1,e.bigInt)}(this,(function(e,t){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=r(e),s=r(t),o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function l(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&r.path)}},r.exports),r.exports}var a=l((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Curl=void 0;class r{constructor(e=r.NUMBER_OF_ROUNDS){if(27!==e&&81!==e)throw new Error("Illegal number of rounds. Only `27` and `81` rounds are supported.");this._state=new Int8Array(r.STATE_LENGTH),this._rounds=e}reset(){this._state=new Int8Array(r.STATE_LENGTH)}rate(e=r.HASH_LENGTH){return this._state.slice(0,e)}absorb(e,t,n){do{const s=n<r.HASH_LENGTH?n:r.HASH_LENGTH;this._state.set(e.subarray(t,t+s)),this.transform(),n-=r.HASH_LENGTH,t+=s}while(n>0)}squeeze(e,t,n){do{const s=n<r.HASH_LENGTH?n:r.HASH_LENGTH;e.set(this._state.subarray(0,s),t),this.transform(),n-=r.HASH_LENGTH,t+=s}while(n>0)}transform(){let e,t=0;for(let n=0;n<this._rounds;n++){e=this._state.slice();for(let n=0;n<r.STATE_LENGTH;n++)this._state[n]=r.TRUTH_TABLE[e[t]+(e[t+=t<365?364:-365]<<2)+5]}}}t.Curl=r,r.HASH_LENGTH=243,r.STATE_LENGTH=3*r.HASH_LENGTH,r.NUMBER_OF_ROUNDS=81,r.TRUTH_TABLE=[1,0,-1,2,1,-1,0,2,-1,1,0]})),u=l((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.TextHelper=void 0;t.TextHelper=class{static encodeNonASCII(e){return"string"==typeof e?e.replace(/[\u007F-\uFFFF]/g,(e=>"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4))):void 0}static decodeNonASCII(e){return"string"==typeof e?e.replace(/\\u(\w{4})/gi,((e,t)=>String.fromCharCode(Number.parseInt(t,16)))):void 0}}})),c=l((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.TrytesHelper=void 0;class r{static isHash(e){return/^[9A-Z]{81}$/.test(e)}static isTag(e){return/^[9A-Z]{27}$/.test(e)}static isTrytes(e){return/^[9A-Z]+$/.test(e)}static toTrits(e){const t=new Int8Array(3*e.length);for(let n=0;n<e.length;n++){const s=r.ALPHABET.indexOf(e.charAt(n));t[3*n]=r.TRYTES_TRITS[s][0],t[3*n+1]=r.TRYTES_TRITS[s][1],t[3*n+2]=r.TRYTES_TRITS[s][2]}return t}static fromTrits(e){let t="";for(let n=0;n<e.length;n+=3)for(let s=0;s<r.ALPHABET.length;s++)if(r.TRYTES_TRITS[s][0]===e[n]&&r.TRYTES_TRITS[s][1]===e[n+1]&&r.TRYTES_TRITS[s][2]===e[n+2]){t+=r.ALPHABET.charAt(s);break}return t}static tritsValue(e){let t=0;for(let r=e.length-1;r>=0;r--)t=3*t+e[r];return t}static fromAscii(e){let t="";for(let n=0;n<e.length;n++){const s=e.charCodeAt(n),o=s%27,i=(s-o)/27;t+=r.ALPHABET[o]+r.ALPHABET[i]}return t}static toAscii(e){const t=e;if(t.length%2==1)throw new Error("The trytes length must be an even number");let n="";for(let e=0;e<t.length;e+=2){const s=r.ALPHABET.indexOf(t[e])+27*r.ALPHABET.indexOf(t[e+1]);n+=String.fromCharCode(s)}return n}static objectToTrytes(e){const t=JSON.stringify(e),n=u.TextHelper.encodeNonASCII(t);return n?r.fromAscii(n):""}static objectFromTrytes(e){if("string"!=typeof e)throw new TypeError("fromTrytes can only convert strings");const t=e.replace(/\9+$/,"");if(0===t.length)throw new Error("fromTrytes trytes does not contain any data");const n=r.toAscii(t),s=u.TextHelper.decodeNonASCII(n);return s?JSON.parse(s):void 0}static stringToTrytes(e){const t=u.TextHelper.encodeNonASCII(e);return t?r.fromAscii(t):""}static stringFromTrytes(e){let t=e.replace(/\9+$/,"");t.length%2==1&&(t+="9");const n=r.toAscii(t);return u.TextHelper.decodeNonASCII(n)}}t.TrytesHelper=r,r.ALPHABET="9ABCDEFGHIJKLMNOPQRSTUVWXYZ",r.TRYTES_TRITS=[new Int8Array([0,0,0]),new Int8Array([1,0,0]),new Int8Array([-1,1,0]),new Int8Array([0,1,0]),new Int8Array([1,1,0]),new Int8Array([-1,-1,1]),new Int8Array([0,-1,1]),new Int8Array([1,-1,1]),new Int8Array([-1,0,1]),new Int8Array([0,0,1]),new Int8Array([1,0,1]),new Int8Array([-1,1,1]),new Int8Array([0,1,1]),new Int8Array([1,1,1]),new Int8Array([-1,-1,-1]),new Int8Array([0,-1,-1]),new Int8Array([1,-1,-1]),new Int8Array([-1,0,-1]),new Int8Array([0,0,-1]),new Int8Array([1,0,-1]),new Int8Array([-1,1,-1]),new Int8Array([0,1,-1]),new Int8Array([1,1,-1]),new Int8Array([-1,-1,0]),new Int8Array([0,-1,0]),new Int8Array([1,-1,0]),new Int8Array([-1,0,0])]})),d=l((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.digestFromSignature=t.checksumSecurity=t.signature=t.privateKeyFromSubseed=t.address=t.digestFromSubseed=t.subseed=t.PRIVATE_KEY_FRAGMENT_LENGTH=void 0;t.PRIVATE_KEY_FRAGMENT_LENGTH=27*a.Curl.HASH_LENGTH;t.subseed=function(e,t){const r=new a.Curl(27),n=e.slice();let s=t;for(;s-- >0;)for(let e=0;e<n.length&&n[e]++>=1;e++)n[e]=-1;r.absorb(n,0,n.length);const o=new Int8Array(a.Curl.HASH_LENGTH);return r.squeeze(o,0,o.length),o},t.digestFromSubseed=function(e,r){const n=new a.Curl(27),s=new a.Curl(27),o=new a.Curl(27),i=r*t.PRIVATE_KEY_FRAGMENT_LENGTH/a.Curl.HASH_LENGTH,l=new Int8Array(a.Curl.HASH_LENGTH);n.absorb(e,0,e.length);for(let e=0;e<i;e++){n.squeeze(l,0,l.length);for(let e=0;e<27;e++)s.reset(),s.absorb(l,0,l.length),s.squeeze(l,0,l.length);o.absorb(l,0,l.length)}return o.squeeze(l,0,l.length),l},t.address=function(e){const t=new a.Curl(27);t.absorb(e,0,e.length);const r=new Int8Array(a.Curl.HASH_LENGTH);return t.squeeze(r,0,r.length),r},t.privateKeyFromSubseed=function(e,r){const n=r*t.PRIVATE_KEY_FRAGMENT_LENGTH,s=new Int8Array(n),o=new Int8Array(n),i=new a.Curl(27);i.absorb(e,0,e.length),i.squeeze(s,0,s.length);for(let e=0;e<n/a.Curl.HASH_LENGTH;e++){const t=e*a.Curl.HASH_LENGTH;i.reset(),i.absorb(s,t,a.Curl.HASH_LENGTH),o.set(i.rate(),t)}return o},t.signature=function(e,t){const r=new Int8Array(t.length),n=new a.Curl(27);for(let s=0;s<t.length/a.Curl.HASH_LENGTH;s++){let o=t.subarray(s*a.Curl.HASH_LENGTH,(s+1)*a.Curl.HASH_LENGTH);for(let t=0;t<13-(e[3*s]+3*e[3*s+1]+9*e[3*s+2]);t++)n.reset(),n.absorb(o,0,o.length),o=n.rate();r.set(o,s*a.Curl.HASH_LENGTH)}return r},t.checksumSecurity=function(e){return 0===e.slice(0,a.Curl.HASH_LENGTH/3).reduce(((e,t)=>e+t),0)?1:0===e.slice(0,2*a.Curl.HASH_LENGTH/3).reduce(((e,t)=>e+t),0)?2:0===e.reduce(((e,t)=>e+t),0)?3:0},t.digestFromSignature=function(e,t){const r=new a.Curl(27),n=new Int8Array(t.length);for(let s=0;s<t.length/a.Curl.HASH_LENGTH;s++){let o=t.slice(s*a.Curl.HASH_LENGTH,(s+1)*a.Curl.HASH_LENGTH);for(let t=0;t<e[3*s]+3*e[3*s+1]+9*e[3*s+2]- -13;t++)r.reset(),r.absorb(o,0,o.length),o=r.rate();n.set(o,s*a.Curl.HASH_LENGTH)}return r.reset(),r.absorb(n,0,n.length),r.rate()}})),f=l((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.generateAddress=void 0,t.generateAddress=function(e,t,r){const n=d.subseed(e,t),s=d.digestFromSubseed(n,r);return{address:d.address(s),privateKey:d.privateKeyFromSubseed(n,r)}}})),h=l((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MerkleNode=void 0;t.MerkleNode=class{constructor(e,t,r,n){this.left=e,this.right=t,this.size=(e?e.size:0)+(t?t.size:0),this.addressTrits=r,this.privateKeyTrits=n}}})),T=l((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MerkleTree=void 0;t.MerkleTree=class{constructor(e,t,r,n){const s=c.TrytesHelper.toTrits(e),o=[];for(let e=0;e<r;e++){const r=f.generateAddress(s,t+e,n);o.push(new h.MerkleNode(void 0,void 0,r.address,r.privateKey)),o[e].size=1}this.root=this.buildTree(o)}static root(e,t,r){const n=new a.Curl(27);let s=1;const o=Math.ceil(t.length/a.Curl.HASH_LENGTH);for(let i=0;i<o;i++){const o=t.slice(i*a.Curl.HASH_LENGTH,(i+1)*a.Curl.HASH_LENGTH);n.reset(),0==(s&r)?(n.absorb(e,0,e.length),n.absorb(o,0,o.length)):(n.absorb(o,0,o.length),n.absorb(e,0,e.length)),s<<=1,e=n.rate()}return n.rate()}getSubtree(e){var t;if(1===this.root.size)return{key:(null===(t=this.root.left)||void 0===t?void 0:t.privateKeyTrits)?this.root.left.privateKeyTrits:new Int8Array,leaves:[]};const r=[];let n,s=this.root,o=this.root.size;if(e<o)for(;s;){if(!s.left){n=s.privateKeyTrits;break}o=s.left.size,e<o?(r.push(s.right?s.right:s.left),s=s.left):(r.push(s.left),s=s.right,e-=o)}return r.reverse(),{key:null!=n?n:new Int8Array,leaves:r}}buildTree(e){const t=[];for(let r=0;r<e.length;r+=2){const n=e[r],s=r+1<e.length?e[r+1]:void 0;let o;if(s){const e=new a.Curl(27);e.absorb(n.addressTrits,0,n.addressTrits.length),e.absorb(s.addressTrits,0,s.addressTrits.length),o=new Int8Array(a.Curl.HASH_LENGTH),e.squeeze(o,0,o.length)}else o=n.addressTrits;t.push(new h.MerkleNode(n,s,o,void 0))}return 1===t.length?t[0]:this.buildTree(t)}}})),H=l((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.roundThird=t.pascalDecode=t.pascalEncode=void 0;const r=new Int8Array([1,0,0,-1]);function n(e){const t=e%3;return 0===t?e:e+3-t}function s(e,t){return e<=t?1:1+s(e,1+3*t)}function o(e){return c.TrytesHelper.tritsValue(e.slice(0,3))>0?3:3+o(e.slice(3))}function i(e,t){const r=l(e,t,0);if(e>=0)return r;for(let e=0;e<t.length;e++)t[e]=-t[e];return r}function l(e,t,r){switch(e){case 0:return 0;default:let n=Math.floor(e/3),s=e%3;return s>1&&(n+=1,s=-1),t[r]=s,1+l(n,t,++r)}}t.pascalEncode=function(e){if(0===e)return r;const t=n(s(Math.abs(e),1)),o=new Int8Array(function(e){const t=n(s(Math.abs(e),1));return t+t/3}(e));i(e,o);let l=0,a=0;for(let e=0;e<t-3;e+=3){const t=o.slice(e,e+3);if(c.TrytesHelper.tritsValue(t)>=0){l|=1<<a;for(let r=0;r<t.length;r++)o[e+r]=-t[r]}a++}const u=o.slice(t-3,t-3+t);if(c.TrytesHelper.tritsValue(u)<0){l|=1<<a;for(let e=0;e<u.length;e++)o[e+t-3]=-o[e+t-3]}const d=new Int8Array(o.length-t);i(l,d);for(let e=0;e<d.length;e++)o[t+e]=d[e];return o},t.pascalDecode=function(e){if(e.length>=r.length&&e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3])return{value:0,end:4};const t=o(e),n=t+t/3,s=c.TrytesHelper.tritsValue(e.slice(t,n));let i=0;for(let r=0;r<t/3;r++){const t=0!=(s>>r&1)?-c.TrytesHelper.tritsValue(e.slice(3*r,3*(r+1))):c.TrytesHelper.tritsValue(e.slice(3*r,3*(r+1)));i+=Math.pow(27,r)*t}return{value:i,end:n}},t.roundThird=n})),y=l((function(e,t){var r=o&&o.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.HammingDiver=void 0;const n=r(s.default);class i{search(e,t,r,n){const s=this.prepareTrits(e,n);let o=Math.min(r,a.Curl.HASH_LENGTH)-n,i=0;for(;0===i;){const e=this.increment(s,n+2*o/3,n+o);o=Math.min(H.roundThird(n+2*o/3+e),a.Curl.HASH_LENGTH)-n;const r={low:s.low.slice(),high:s.high.slice()};this.transform(r),i=this.check(t,r.low,r.high)}return this.trinaryGet(s.low,s.high,o,i)}prepareTrits(e,t){const r=this.tritsToBigInt(e,a.Curl.STATE_LENGTH);return r.low[t]=i.LOW_0,r.low[t+1]=i.LOW_1,r.low[t+2]=i.LOW_2,r.low[t+3]=i.LOW_3,r.high[t]=i.HIGH_0,r.high[t+1]=i.HIGH_1,r.high[t+2]=i.HIGH_2,r.high[t+3]=i.HIGH_3,r}tritsToBigInt(e,t){const r={low:[],high:[]};for(let t=0;t<e.length;t++)switch(e[t]){case 0:r.low[t]=i.MAX_VALUE,r.high[t]=i.MAX_VALUE;break;case 1:r.low[t]=i.MIN_VALUE,r.high[t]=i.MAX_VALUE;break;default:r.low[t]=i.MAX_VALUE,r.high[t]=i.MIN_VALUE}if(e.length>=t)return r;for(let n=e.length;n<t;n++)r.low[n]=i.MAX_VALUE,r.high[n]=i.MAX_VALUE;return r}increment(e,t,r){for(let n=t;n<r;n++){const s=e.low[n],o=e.high[n];if(e.low[n]=o.xor(s),e.high[n]=s,o.and(s.not()).equals(0))return r-t}return r-t+1}transform(e){let t=0;for(let r=0;r<i.ROUNDS;r++){const r={low:e.low.slice(0,a.Curl.STATE_LENGTH),high:e.high.slice(0,a.Curl.STATE_LENGTH)};for(let n=0;n<a.Curl.STATE_LENGTH;n++){const s=r.low[t],o=r.high[t];t+=t<365?364:-365;const i=r.high[t],l=r.low[t].xor(o),a=this.bitWiseNot(i),u=s.or(a).and(l);e.low[n]=this.bitWiseNot(u);const c=s.xor(i);e.high[n]=c.or(u)}}}bitWiseNot(e){return n.default(1).shiftLeft(64).subtract(n.default(1)).subtract(e)}check(e,t,r){for(let s=0;s<64;s++){let o=0;for(let i=0;i<e;i++){for(let e=243*i/3;e<243*(i+1)/3;e++){const i=n.default(1).shiftLeft(s);t[e].and(i).equals(0)?o--:r[e].and(i).equals(0)&&o++}if(0===o&&i<e-1){o=1;break}}if(0===o)return s}return 0}trinaryGet(e,t,r,s){const o=new Int8Array(r);for(let i=0;i<r;i++){const r=n.default(s),l=e[i].shiftRight(r).and(1),a=t[i].shiftRight(r).and(1);l.equals(1)&&a.equals(0)?o[i]=-1:l.equals(0)&&a.equals(1)?o[i]=1:o[i]=0}return o}}t.HammingDiver=i,i.MAX_VALUE=n.default("FFFFFFFFFFFFFFFF",16),i.MIN_VALUE=n.default("0000000000000000",16),i.HIGH_0=n.default("B6DB6DB6DB6DB6DB",16),i.HIGH_1=n.default("8FC7E3F1F8FC7E3F",16),i.HIGH_2=n.default("FFC01FFFF803FFFF",16),i.HIGH_3=n.default("003FFFFFFFFFFFFF",16),i.LOW_0=n.default("DB6DB6DB6DB6DB6D",16),i.LOW_1=n.default("F1F8FC7E3F1F8FC7",16),i.LOW_2=n.default("7FFFE00FFFFC01FF",16),i.LOW_3=n.default("FFC0000007FFFFFF",16),i.ROUNDS=27})),A=l((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.concatenate=void 0,t.concatenate=function(e){let t=0;for(const r of e)t+=r.length;const r=new Int8Array(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return r}})),g=l((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.validateModeKey=void 0,t.validateModeKey=function(e,t){if("public"!==e&&"private"!==e&&"restricted"!==e)throw new Error(`The mode must be public, private or restricted, it is '${e}'`);if("restricted"===e){if(!t)throw new Error("You must provide a sideKey for restricted mode");if(!c.TrytesHelper.isTrytes(t))throw new Error("The sideKey must be in trytes");if(t.length>81)throw new Error("The sideKey must be maximum length 81 trytes")}if("restricted"!==e&&t)throw new Error("sideKey is only used in restricted mode")}})),_=l((function(e,t){function r(e,t){const r=e+t;switch(r){case 2:return-1;case-2:return 1;default:return r}}Object.defineProperty(t,"__esModule",{value:!0}),t.unmask=t.mask=t.maskHash=void 0,t.maskHash=function(e){const t=new a.Curl(81);t.absorb(e,0,e.length);const r=new Int8Array(a.Curl.HASH_LENGTH);return t.squeeze(r,0,r.length),r},t.mask=function(e,t){const n=t.rate(),s=Math.ceil(e.length/a.Curl.HASH_LENGTH);for(let o=0;o<s;o++){const s=e.slice(o*a.Curl.HASH_LENGTH,(o+1)*a.Curl.HASH_LENGTH);t.absorb(s,0,s.length);const i=t.rate();for(let t=0;t<s.length;t++)e[o*a.Curl.HASH_LENGTH+t]=r(s[t],n[t]),n[t]=i[t]}return e},t.unmask=function(e,t){const n=new Int8Array(e),s=Math.ceil(n.length/a.Curl.HASH_LENGTH)*a.Curl.HASH_LENGTH;let o;for(let e=0;e<s;e++){const s=e%a.Curl.HASH_LENGTH;0===s&&(o=t.rate()),o&&(n[e]=r(n[e],-o[s])),s===a.Curl.HASH_LENGTH-1&&t.absorb(n,Math.floor(e/a.Curl.HASH_LENGTH)*a.Curl.HASH_LENGTH,a.Curl.HASH_LENGTH)}return n}})),p=l((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createMessage=t.channelRoot=t.createChannel=void 0,t.createChannel=function(e,t,r,n){if(!c.TrytesHelper.isHash(e))throw new Error("The seed must be 81 trytes long");if(t<1||t>3)throw new Error("Security must be between 1 and 3, it is "+t);return g.validateModeKey(r,n),{seed:e,mode:r,sideKey:"restricted"===r?(null!=n?n:"").padEnd(81,"9"):void 0,security:t,start:0,count:1,nextCount:1,index:0}},t.channelRoot=function(e){if(!e)throw new Error("channelState must be provided");if(e.start<0)throw new Error("channelState.start must be >= 0");if(e.count<=0)throw new Error("channelState.count must be > 0");if(e.security<1||e.security>3)throw new Error("channelState.security must be between 1 and 3, it is "+e.security);const t=new T.MerkleTree(e.seed,e.start,e.count,e.security);return c.TrytesHelper.fromTrits(t.root.addressTrits)},t.createMessage=function(e,t){var r;if(!c.TrytesHelper.isTrytes(t))throw new Error("The message must be in trytes");const n=new T.MerkleTree(e.seed,e.start,e.count,e.security),s=new T.MerkleTree(e.seed,e.start+e.count,e.nextCount,e.security).root.addressTrits,o=c.TrytesHelper.toTrits(t),i=H.pascalEncode(e.index),l=H.pascalEncode(o.length),u=n.getSubtree(e.index),f=new a.Curl(27),h=c.TrytesHelper.toTrits(null!==(r=e.sideKey)&&void 0!==r?r:"9".repeat(81));f.absorb(h,0,h.length),f.absorb(n.root.addressTrits,0,n.root.addressTrits.length);let g=A.concatenate([i,l]);f.absorb(g,0,g.length);const p=_.mask(A.concatenate([s,o]),f);g=A.concatenate([g,p]);const E=(new y.HammingDiver).search(f.rate(a.Curl.STATE_LENGTH),e.security,a.Curl.HASH_LENGTH/3,0);_.mask(E,f),g=A.concatenate([g,E]);const b=d.signature(f.rate(),u.key),w=A.concatenate(u.leaves.map((e=>e.addressTrits))),m=w.length/a.Curl.HASH_LENGTH,S=_.mask(A.concatenate([b,H.pascalEncode(m),w]),f);g=A.concatenate([g,S]);const v=g.length%3;0!==v&&(g=A.concatenate([g,new Int8Array(3-v).fill(0)]));const N="public"===e.mode?n.root.addressTrits:_.maskHash(n.root.addressTrits),L={payload:c.TrytesHelper.fromTrits(g),root:c.TrytesHelper.fromTrits(n.root.addressTrits),address:c.TrytesHelper.fromTrits(N)};return e.index===e.count-1?(e.start=e.nextCount+e.start,e.index=0):e.index++,e.nextRoot=c.TrytesHelper.fromTrits(s),L}})),E=l((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.parseMessage=void 0,t.parseMessage=function(e,t,r){const n=c.TrytesHelper.toTrits(e),s=c.TrytesHelper.toTrits(t),o=c.TrytesHelper.toTrits(null!=r?r:"9".repeat(81)),i=H.pascalDecode(n),l=i.value,u=H.pascalDecode(n.slice(i.end)),f=u.value,h=i.end+u.end,y=h+a.Curl.HASH_LENGTH,A=y+f,g=new a.Curl(27);g.absorb(o,0,o.length),g.absorb(s,0,s.length),g.absorb(n,0,h);const p=_.unmask(n.slice(h,h+a.Curl.HASH_LENGTH),g),E=_.unmask(n.slice(y,y+f),g),b=_.unmask(n.slice(A,A+a.Curl.HASH_LENGTH/3),g),w=g.rate(),m=d.checksumSecurity(w);if(0===m)throw new Error("Message Hash did not have a hamming weight of zero, security level is invalid");const S=_.unmask(n.slice(A+b.length),g);g.reset();const v=S.slice(0,m*d.PRIVATE_KEY_FRAGMENT_LENGTH),N=d.digestFromSignature(w,v);g.absorb(N,0,N.length);const L=H.pascalDecode(S.slice(m*d.PRIVATE_KEY_FRAGMENT_LENGTH)),F=L.value;let I=g.rate();if(0!==F){const e=m*d.PRIVATE_KEY_FRAGMENT_LENGTH+L.end,t=S.slice(e,e+F*a.Curl.HASH_LENGTH);I=T.MerkleTree.root(I,t,l)}if(c.TrytesHelper.fromTrits(I)!==t)throw new Error("Signature did not match expected root");return{nextRoot:c.TrytesHelper.fromTrits(p),message:c.TrytesHelper.fromTrits(E)}}})),b=l((function(e,t){var r=o&&o.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,o){function i(e){try{a(n.next(e))}catch(e){o(e)}}function l(e){try{a(n.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,l)}a((n=n.apply(e,t||[])).next())}))};function s(e,t,n,s){return r(this,void 0,void 0,(function*(){g.validateModeKey(n,s);const r=i(t,n);try{const n=yield e.messagesFind(r),o=[];for(const t of n.messageIds)try{const r=yield e.message(t);o.push(r)}catch(e){}return yield l(o,t,s)}catch(e){}}))}function i(e,t){return"public"===t?e:c.TrytesHelper.fromTrits(_.maskHash(c.TrytesHelper.toTrits(e)))}function l(e,t,s){return r(this,void 0,void 0,(function*(){if(e&&0!==e.length)for(const r of e)if(r.payload&&2===r.payload.type){const e=n.default.Converter.hexToBytes(r.payload.data);if(e.length>100){const r=e[0];if(0===r||r>27)return;const o=n.default.Converter.bytesToAscii(e.slice(1,1+r)),i=n.default.Converter.bytesToAscii(e.slice(1+r));try{const e=E.parseMessage(i,t,s);return Object.assign(Object.assign({root:t},e),{tag:o})}catch(e){}}}}))}Object.defineProperty(t,"__esModule",{value:!0}),t.decodeMessages=t.mamFetchAll=t.decodeAddress=t.mamFetch=t.mamAttach=void 0,t.mamAttach=function(e,t,s){return r(this,void 0,void 0,(function*(){if(void 0!==s&&"string"!=typeof s)throw new Error("MWM and depth are no longer needed when calling mamAttach");const r=s?s.length:0,o=new Uint8Array(1+r+t.payload.length);o[0]=r,s&&o.set(n.default.Converter.asciiToBytes(s),1),o.set(n.default.Converter.asciiToBytes(t.payload),1+r);const i={type:2,index:t.address,data:n.default.Converter.bytesToHex(o)},l=yield e.tips(),a={version:1,parent1MessageId:l.tip1MessageId,parent2MessageId:l.tip2MessageId,payload:i,nonce:0};return{message:a,messageId:yield e.messageSubmit(a)}}))},t.mamFetch=s,t.decodeAddress=i,t.mamFetchAll=function(e,t,n,o,i){return r(this,void 0,void 0,(function*(){g.validateModeKey(n,o);const r=void 0===i?Number.MAX_VALUE:i,l=[];let a=t;do{const t=yield s(e,a,n,o);t?(l.push(t),a=t.nextRoot):a=void 0}while(a&&l.length<r);return l}))},t.decodeMessages=l})),w=l((function(e,t){Object.defineProperty(t,"__esModule",{value:!0})})),m=l((function(e,t){Object.defineProperty(t,"__esModule",{value:!0})})),S=l((function(e,t){Object.defineProperty(t,"__esModule",{value:!0})})),v=l((function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}));return i(l((function(e,t){var r=o&&o.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=o&&o.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.SingleNodeClient=void 0,Object.defineProperty(t,"SingleNodeClient",{enumerable:!0,get:function(){return n.default.SingleNodeClient}}),s(p,t),s(b,t),s(E,t),s(w,t),s(m,t),s(S,t),s(v,t),s(c,t)})))}));