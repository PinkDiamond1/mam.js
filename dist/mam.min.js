!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@iota/iota2.js"),require("big-integer")):"function"==typeof define&&define.amd?define(["@iota/iota2.js","big-integer"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).mam=t(e.iota2_js_1,e.bigInt)}(this,(function(e,t){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=r(e),o=r(t),s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function i(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&r.path)}},r.exports),r.exports}var a=i((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Curl=void 0;class r{constructor(e=r.NUMBER_OF_ROUNDS){if(27!==e&&81!==e)throw new Error("Illegal number of rounds. Only `27` and `81` rounds are supported.");this._state=new Int8Array(r.STATE_LENGTH),this._rounds=e}reset(){this._state=new Int8Array(r.STATE_LENGTH)}rate(e=r.HASH_LENGTH){return this._state.slice(0,e)}absorb(e,t,n){do{const o=n<r.HASH_LENGTH?n:r.HASH_LENGTH;this._state.set(e.subarray(t,t+o)),this.transform(),n-=r.HASH_LENGTH,t+=o}while(n>0)}squeeze(e,t,n){do{const o=n<r.HASH_LENGTH?n:r.HASH_LENGTH;e.set(this._state.subarray(0,o),t),this.transform(),n-=r.HASH_LENGTH,t+=o}while(n>0)}transform(){let e,t=0;for(let n=0;n<this._rounds;n++){e=this._state.slice();for(let n=0;n<r.STATE_LENGTH;n++)this._state[n]=r.TRUTH_TABLE[e[t]+(e[t+=t<365?364:-365]<<2)+5]}}}t.Curl=r,r.HASH_LENGTH=243,r.STATE_LENGTH=3*r.HASH_LENGTH,r.NUMBER_OF_ROUNDS=81,r.TRUTH_TABLE=[1,0,-1,2,1,-1,0,2,-1,1,0]})),l=i((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.TextHelper=void 0,t.TextHelper=class{static encodeNonASCII(e){return"string"==typeof e?e.replace(/[\u007F-\uFFFF]/g,(e=>"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4))):void 0}static decodeNonASCII(e){return"string"==typeof e?e.replace(/\\u(\w{4})/gi,((e,t)=>String.fromCharCode(Number.parseInt(t,16)))):void 0}}})),u=i((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.TrytesHelper=void 0;class r{static isHash(e){return/^[9A-Z]{81}$/.test(e)}static isTag(e){return/^[9A-Z]{27}$/.test(e)}static isTrytes(e){return/^[9A-Z]+$/.test(e)}static toTrits(e){const t=new Int8Array(3*e.length);for(let n=0;n<e.length;n++){const o=r.ALPHABET.indexOf(e.charAt(n));t[3*n]=r.TRYTES_TRITS[o][0],t[3*n+1]=r.TRYTES_TRITS[o][1],t[3*n+2]=r.TRYTES_TRITS[o][2]}return t}static fromTrits(e){let t="";for(let n=0;n<e.length;n+=3)for(let o=0;o<r.ALPHABET.length;o++)if(r.TRYTES_TRITS[o][0]===e[n]&&r.TRYTES_TRITS[o][1]===e[n+1]&&r.TRYTES_TRITS[o][2]===e[n+2]){t+=r.ALPHABET.charAt(o);break}return t}static tritsValue(e){let t=0;for(let r=e.length-1;r>=0;r--)t=3*t+e[r];return t}static fromAscii(e){let t="";for(let n=0;n<e.length;n++){const o=e.charCodeAt(n),s=o%27,i=(o-s)/27;t+=r.ALPHABET[s]+r.ALPHABET[i]}return t}static toAscii(e){const t=e;if(t.length%2==1)throw new Error("The trytes length must be an even number");let n="";for(let e=0;e<t.length;e+=2){const o=r.ALPHABET.indexOf(t[e])+27*r.ALPHABET.indexOf(t[e+1]);n+=String.fromCharCode(o)}return n}static objectToTrytes(e){const t=JSON.stringify(e),n=l.TextHelper.encodeNonASCII(t);return n?r.fromAscii(n):""}static objectFromTrytes(e){if("string"!=typeof e)throw new TypeError("fromTrytes can only convert strings");const t=e.replace(/\9+$/,"");if(0===t.length)throw new Error("fromTrytes trytes does not contain any data");const n=r.toAscii(t),o=l.TextHelper.decodeNonASCII(n);return o?JSON.parse(o):void 0}static stringToTrytes(e){const t=l.TextHelper.encodeNonASCII(e);return t?r.fromAscii(t):""}static stringFromTrytes(e){let t=e.replace(/\9+$/,"");t.length%2==1&&(t+="9");const n=r.toAscii(t);return l.TextHelper.decodeNonASCII(n)}}t.TrytesHelper=r,r.ALPHABET="9ABCDEFGHIJKLMNOPQRSTUVWXYZ",r.TRYTES_TRITS=[new Int8Array([0,0,0]),new Int8Array([1,0,0]),new Int8Array([-1,1,0]),new Int8Array([0,1,0]),new Int8Array([1,1,0]),new Int8Array([-1,-1,1]),new Int8Array([0,-1,1]),new Int8Array([1,-1,1]),new Int8Array([-1,0,1]),new Int8Array([0,0,1]),new Int8Array([1,0,1]),new Int8Array([-1,1,1]),new Int8Array([0,1,1]),new Int8Array([1,1,1]),new Int8Array([-1,-1,-1]),new Int8Array([0,-1,-1]),new Int8Array([1,-1,-1]),new Int8Array([-1,0,-1]),new Int8Array([0,0,-1]),new Int8Array([1,0,-1]),new Int8Array([-1,1,-1]),new Int8Array([0,1,-1]),new Int8Array([1,1,-1]),new Int8Array([-1,-1,0]),new Int8Array([0,-1,0]),new Int8Array([1,-1,0]),new Int8Array([-1,0,0])]})),c=i((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.digestFromSignature=t.checksumSecurity=t.signature=t.privateKeyFromSubseed=t.address=t.digestFromSubseed=t.subseed=t.PRIVATE_KEY_FRAGMENT_LENGTH=void 0,t.PRIVATE_KEY_FRAGMENT_LENGTH=27*a.Curl.HASH_LENGTH,t.subseed=function(e,t){const r=new a.Curl(27),n=e.slice();let o=t;for(;o-- >0;)for(let e=0;e<n.length&&n[e]++>=1;e++)n[e]=-1;r.absorb(n,0,n.length);const s=new Int8Array(a.Curl.HASH_LENGTH);return r.squeeze(s,0,s.length),s},t.digestFromSubseed=function(e,r){const n=new a.Curl(27),o=new a.Curl(27),s=new a.Curl(27),i=r*t.PRIVATE_KEY_FRAGMENT_LENGTH/a.Curl.HASH_LENGTH,l=new Int8Array(a.Curl.HASH_LENGTH);n.absorb(e,0,e.length);for(let e=0;e<i;e++){n.squeeze(l,0,l.length);for(let e=0;e<27;e++)o.reset(),o.absorb(l,0,l.length),o.squeeze(l,0,l.length);s.absorb(l,0,l.length)}return s.squeeze(l,0,l.length),l},t.address=function(e){const t=new a.Curl(27);t.absorb(e,0,e.length);const r=new Int8Array(a.Curl.HASH_LENGTH);return t.squeeze(r,0,r.length),r},t.privateKeyFromSubseed=function(e,r){const n=r*t.PRIVATE_KEY_FRAGMENT_LENGTH,o=new Int8Array(n),s=new Int8Array(n),i=new a.Curl(27);i.absorb(e,0,e.length),i.squeeze(o,0,o.length);for(let e=0;e<n/a.Curl.HASH_LENGTH;e++){const t=e*a.Curl.HASH_LENGTH;i.reset(),i.absorb(o,t,a.Curl.HASH_LENGTH),s.set(i.rate(),t)}return s},t.signature=function(e,t){const r=new Int8Array(t.length),n=new a.Curl(27);for(let o=0;o<t.length/a.Curl.HASH_LENGTH;o++){let s=t.subarray(o*a.Curl.HASH_LENGTH,(o+1)*a.Curl.HASH_LENGTH);for(let t=0;t<13-(e[3*o]+3*e[3*o+1]+9*e[3*o+2]);t++)n.reset(),n.absorb(s,0,s.length),s=n.rate();r.set(s,o*a.Curl.HASH_LENGTH)}return r},t.checksumSecurity=function(e){return 0===e.slice(0,a.Curl.HASH_LENGTH/3).reduce(((e,t)=>e+t),0)?1:0===e.slice(0,2*a.Curl.HASH_LENGTH/3).reduce(((e,t)=>e+t),0)?2:0===e.reduce(((e,t)=>e+t),0)?3:0},t.digestFromSignature=function(e,t){const r=new a.Curl(27),n=new Int8Array(t.length);for(let o=0;o<t.length/a.Curl.HASH_LENGTH;o++){let s=t.slice(o*a.Curl.HASH_LENGTH,(o+1)*a.Curl.HASH_LENGTH);for(let t=0;t<e[3*o]+3*e[3*o+1]+9*e[3*o+2]- -13;t++)r.reset(),r.absorb(s,0,s.length),s=r.rate();n.set(s,o*a.Curl.HASH_LENGTH)}return r.reset(),r.absorb(n,0,n.length),r.rate()}})),d=i((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.generateAddress=void 0,t.generateAddress=function(e,t,r){const n=c.subseed(e,t),o=c.digestFromSubseed(n,r);return{address:c.address(o),privateKey:c.privateKeyFromSubseed(n,r)}}})),f=i((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MerkleNode=void 0,t.MerkleNode=class{constructor(e,t,r,n){this.left=e,this.right=t,this.size=(e?e.size:0)+(t?t.size:0),this.addressTrits=r,this.privateKeyTrits=n}}})),h=i((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MerkleTree=void 0,t.MerkleTree=class{constructor(e,t,r,n){const o=u.TrytesHelper.toTrits(e),s=[];for(let e=0;e<r;e++){const r=d.generateAddress(o,t+e,n);s.push(new f.MerkleNode(void 0,void 0,r.address,r.privateKey)),s[e].size=1}this.root=this.buildTree(s)}static root(e,t,r){const n=new a.Curl(27);let o=1;const s=Math.ceil(t.length/a.Curl.HASH_LENGTH);for(let i=0;i<s;i++){const s=t.slice(i*a.Curl.HASH_LENGTH,(i+1)*a.Curl.HASH_LENGTH);n.reset(),0==(o&r)?(n.absorb(e,0,e.length),n.absorb(s,0,s.length)):(n.absorb(s,0,s.length),n.absorb(e,0,e.length)),o<<=1,e=n.rate()}return n.rate()}getSubtree(e){var t;if(1===this.root.size)return{key:(null===(t=this.root.left)||void 0===t?void 0:t.privateKeyTrits)?this.root.left.privateKeyTrits:new Int8Array,leaves:[]};const r=[];let n,o=this.root,s=this.root.size;if(e<s)for(;o;){if(!o.left){n=o.privateKeyTrits;break}s=o.left.size,e<s?(r.push(o.right?o.right:o.left),o=o.left):(r.push(o.left),o=o.right,e-=s)}return r.reverse(),{key:null!=n?n:new Int8Array,leaves:r}}buildTree(e){const t=[];for(let r=0;r<e.length;r+=2){const n=e[r],o=r+1<e.length?e[r+1]:void 0;let s;if(o){const e=new a.Curl(27);e.absorb(n.addressTrits,0,n.addressTrits.length),e.absorb(o.addressTrits,0,o.addressTrits.length),s=new Int8Array(a.Curl.HASH_LENGTH),e.squeeze(s,0,s.length)}else s=n.addressTrits;t.push(new f.MerkleNode(n,o,s,void 0))}return 1===t.length?t[0]:this.buildTree(t)}}})),T=i((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.roundThird=t.pascalDecode=t.pascalEncode=void 0;const r=new Int8Array([1,0,0,-1]);function n(e){const t=e%3;return 0===t?e:e+3-t}function o(e,t){return e<=t?1:1+o(e,1+3*t)}function s(e){return u.TrytesHelper.tritsValue(e.slice(0,3))>0?3:3+s(e.slice(3))}function i(e,t){const r=a(e,t,0);if(e>=0)return r;for(let e=0;e<t.length;e++)t[e]=-t[e];return r}function a(e,t,r){switch(e){case 0:return 0;default:let n=Math.floor(e/3),o=e%3;return o>1&&(n+=1,o=-1),t[r]=o,1+a(n,t,++r)}}t.pascalEncode=function(e){if(0===e)return r;const t=n(o(Math.abs(e),1)),s=new Int8Array(function(e){const t=n(o(Math.abs(e),1));return t+t/3}(e));i(e,s);let a=0,l=0;for(let e=0;e<t-3;e+=3){const t=s.slice(e,e+3);if(u.TrytesHelper.tritsValue(t)>=0){a|=1<<l;for(let r=0;r<t.length;r++)s[e+r]=-t[r]}l++}const c=s.slice(t-3,t-3+t);if(u.TrytesHelper.tritsValue(c)<0){a|=1<<l;for(let e=0;e<c.length;e++)s[e+t-3]=-s[e+t-3]}const d=new Int8Array(s.length-t);i(a,d);for(let e=0;e<d.length;e++)s[t+e]=d[e];return s},t.pascalDecode=function(e){if(e.length>=r.length&&e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3])return{value:0,end:4};const t=s(e),n=t+t/3,o=u.TrytesHelper.tritsValue(e.slice(t,n));let i=0;for(let r=0;r<t/3;r++){const t=0!=(o>>r&1)?-u.TrytesHelper.tritsValue(e.slice(3*r,3*(r+1))):u.TrytesHelper.tritsValue(e.slice(3*r,3*(r+1)));i+=Math.pow(27,r)*t}return{value:i,end:n}},t.roundThird=n})),H=i((function(e,t){var r=s&&s.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.HammingDiver=void 0;const n=r(o.default);class i{search(e,t,r,n){const o=this.prepareTrits(e,n);let s=Math.min(r,a.Curl.HASH_LENGTH)-n,i=0;for(;0===i;){const e=this.increment(o,n+2*s/3,n+s);s=Math.min(T.roundThird(n+2*s/3+e),a.Curl.HASH_LENGTH)-n;const r={low:o.low.slice(),high:o.high.slice()};this.transform(r),i=this.check(t,r.low,r.high)}return this.trinaryGet(o.low,o.high,s,i)}prepareTrits(e,t){const r=this.tritsToBigInt(e,a.Curl.STATE_LENGTH);return r.low[t]=i.LOW_0,r.low[t+1]=i.LOW_1,r.low[t+2]=i.LOW_2,r.low[t+3]=i.LOW_3,r.high[t]=i.HIGH_0,r.high[t+1]=i.HIGH_1,r.high[t+2]=i.HIGH_2,r.high[t+3]=i.HIGH_3,r}tritsToBigInt(e,t){const r={low:[],high:[]};for(let t=0;t<e.length;t++)switch(e[t]){case 0:r.low[t]=i.MAX_VALUE,r.high[t]=i.MAX_VALUE;break;case 1:r.low[t]=i.MIN_VALUE,r.high[t]=i.MAX_VALUE;break;default:r.low[t]=i.MAX_VALUE,r.high[t]=i.MIN_VALUE}if(e.length>=t)return r;for(let n=e.length;n<t;n++)r.low[n]=i.MAX_VALUE,r.high[n]=i.MAX_VALUE;return r}increment(e,t,r){for(let n=t;n<r;n++){const o=e.low[n],s=e.high[n];if(e.low[n]=s.xor(o),e.high[n]=o,s.and(o.not()).equals(0))return r-t}return r-t+1}transform(e){let t=0;for(let r=0;r<i.ROUNDS;r++){const r={low:e.low.slice(0,a.Curl.STATE_LENGTH),high:e.high.slice(0,a.Curl.STATE_LENGTH)};for(let n=0;n<a.Curl.STATE_LENGTH;n++){const o=r.low[t],s=r.high[t];t+=t<365?364:-365;const i=r.high[t],a=r.low[t].xor(s),l=this.bitWiseNot(i),u=o.or(l).and(a);e.low[n]=this.bitWiseNot(u);const c=o.xor(i);e.high[n]=c.or(u)}}}bitWiseNot(e){return n.default(1).shiftLeft(64).subtract(n.default(1)).subtract(e)}check(e,t,r){for(let o=0;o<64;o++){let s=0;for(let i=0;i<e;i++){for(let e=243*i/3;e<243*(i+1)/3;e++){const i=n.default(1).shiftLeft(o);t[e].and(i).equals(0)?s--:r[e].and(i).equals(0)&&s++}if(0===s&&i<e-1){s=1;break}}if(0===s)return o}return 0}trinaryGet(e,t,r,o){const s=new Int8Array(r);for(let i=0;i<r;i++){const r=n.default(o),a=e[i].shiftRight(r).and(1),l=t[i].shiftRight(r).and(1);a.equals(1)&&l.equals(0)?s[i]=-1:a.equals(0)&&l.equals(1)?s[i]=1:s[i]=0}return s}}t.HammingDiver=i,i.MAX_VALUE=n.default("FFFFFFFFFFFFFFFF",16),i.MIN_VALUE=n.default("0000000000000000",16),i.HIGH_0=n.default("B6DB6DB6DB6DB6DB",16),i.HIGH_1=n.default("8FC7E3F1F8FC7E3F",16),i.HIGH_2=n.default("FFC01FFFF803FFFF",16),i.HIGH_3=n.default("003FFFFFFFFFFFFF",16),i.LOW_0=n.default("DB6DB6DB6DB6DB6D",16),i.LOW_1=n.default("F1F8FC7E3F1F8FC7",16),i.LOW_2=n.default("7FFFE00FFFFC01FF",16),i.LOW_3=n.default("FFC0000007FFFFFF",16),i.ROUNDS=27})),y=i((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.concatenate=void 0,t.concatenate=function(e){let t=0;for(const r of e)t+=r.length;const r=new Int8Array(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return r}})),b=i((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.validateModeKey=void 0,t.validateModeKey=function(e,t){if("public"!==e&&"private"!==e&&"restricted"!==e)throw new Error(`The mode must be public, private or restricted, it is '${e}'`);if("restricted"===e){if(!t)throw new Error("You must provide a sideKey for restricted mode");if(!u.TrytesHelper.isTrytes(t))throw new Error("The sideKey must be in trytes");if(t.length>81)throw new Error("The sideKey must be maximum length 81 trytes")}if("restricted"!==e&&t)throw new Error("sideKey is only used in restricted mode")}})),A=i((function(e,t){function r(e,t){const r=e+t;switch(r){case 2:return-1;case-2:return 1;default:return r}}Object.defineProperty(t,"__esModule",{value:!0}),t.unmask=t.mask=t.maskHash=void 0,t.maskHash=function(e){const t=new a.Curl(81);t.absorb(e,0,e.length);const r=new Int8Array(a.Curl.HASH_LENGTH);return t.squeeze(r,0,r.length),r},t.mask=function(e,t){const n=t.rate(),o=Math.ceil(e.length/a.Curl.HASH_LENGTH);for(let s=0;s<o;s++){const o=e.slice(s*a.Curl.HASH_LENGTH,(s+1)*a.Curl.HASH_LENGTH);t.absorb(o,0,o.length);const i=t.rate();for(let t=0;t<o.length;t++)e[s*a.Curl.HASH_LENGTH+t]=r(o[t],n[t]),n[t]=i[t]}return e},t.unmask=function(e,t){const n=new Int8Array(e),o=Math.ceil(n.length/a.Curl.HASH_LENGTH)*a.Curl.HASH_LENGTH;let s;for(let e=0;e<o;e++){const o=e%a.Curl.HASH_LENGTH;0===o&&(s=t.rate()),s&&(n[e]=r(n[e],-s[o])),o===a.Curl.HASH_LENGTH-1&&t.absorb(n,Math.floor(e/a.Curl.HASH_LENGTH)*a.Curl.HASH_LENGTH,a.Curl.HASH_LENGTH)}return n}})),g=i((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createMessage=t.channelRoot=t.createChannel=void 0,t.createChannel=function(e,t,r,n){if(!u.TrytesHelper.isHash(e))throw new Error("The seed must be 81 trytes long");if(t<1||t>3)throw new Error("Security must be between 1 and 3, it is "+t);return b.validateModeKey(r,n),{seed:e,mode:r,sideKey:"restricted"===r?(null!=n?n:"").padEnd(81,"9"):void 0,security:t,start:0,count:1,nextCount:1,index:0}},t.channelRoot=function(e){if(!e)throw new Error("channelState must be provided");if(e.start<0)throw new Error("channelState.start must be >= 0");if(e.count<=0)throw new Error("channelState.count must be > 0");if(e.security<1||e.security>3)throw new Error("channelState.security must be between 1 and 3, it is "+e.security);const t=new h.MerkleTree(e.seed,e.start,e.count,e.security);return u.TrytesHelper.fromTrits(t.root.addressTrits)},t.createMessage=function(e,t){var r;if(!u.TrytesHelper.isTrytes(t))throw new Error("The message must be in trytes");const n=new h.MerkleTree(e.seed,e.start,e.count,e.security),o=new h.MerkleTree(e.seed,e.start+e.count,e.nextCount,e.security).root.addressTrits,s=u.TrytesHelper.toTrits(t),i=T.pascalEncode(e.index),l=T.pascalEncode(s.length),d=n.getSubtree(e.index),f=new a.Curl(27),b=u.TrytesHelper.toTrits(null!==(r=e.sideKey)&&void 0!==r?r:"9".repeat(81));f.absorb(b,0,b.length),f.absorb(n.root.addressTrits,0,n.root.addressTrits.length);let g=y.concatenate([i,l]);f.absorb(g,0,g.length);const _=A.mask(y.concatenate([o,s]),f);g=y.concatenate([g,_]);const w=(new H.HammingDiver).search(f.rate(a.Curl.STATE_LENGTH),e.security,a.Curl.HASH_LENGTH/3,0);A.mask(w,f),g=y.concatenate([g,w]);const p=c.signature(f.rate(),d.key),E=y.concatenate(d.leaves.map((e=>e.addressTrits))),m=E.length/a.Curl.HASH_LENGTH,v=A.mask(y.concatenate([p,T.pascalEncode(m),E]),f);g=y.concatenate([g,v]);const S=g.length%3;0!==S&&(g=y.concatenate([g,new Int8Array(3-S).fill(0)]));const I="public"===e.mode?n.root.addressTrits:A.maskHash(n.root.addressTrits),F={payload:u.TrytesHelper.fromTrits(g),root:u.TrytesHelper.fromTrits(n.root.addressTrits),address:u.TrytesHelper.fromTrits(I)};return e.index===e.count-1?(e.start=e.nextCount+e.start,e.index=0):e.index++,e.nextRoot=u.TrytesHelper.fromTrits(o),F}}));var _=function(e){var t;if(e instanceof Uint8Array)t=e;else if(e instanceof Buffer)t=new Uint8Array(e);else{if("string"!=typeof e)throw new Error("Input must be an string, Buffer or Uint8Array");t=new Uint8Array(Buffer.from(e,"utf8"))}return t},w=function(e){return Array.prototype.map.call(e,(function(e){return(e<16?"0":"")+e.toString(16)})).join("")};function p(e,t,r){var n=e[t]+e[r],o=e[t+1]+e[r+1];n>=4294967296&&o++,e[t]=n,e[t+1]=o}function E(e,t,r,n){var o=e[t]+r;r<0&&(o+=4294967296);var s=e[t+1]+n;o>=4294967296&&s++,e[t]=o,e[t+1]=s}function m(e,t){return e[t]^e[t+1]<<8^e[t+2]<<16^e[t+3]<<24}function v(e,t,r,n,o,s){var i=N[o],a=N[o+1],l=N[s],u=N[s+1];p(F,e,t),E(F,e,i,a);var c=F[n]^F[e],d=F[n+1]^F[e+1];F[n]=d,F[n+1]=c,p(F,r,n),c=F[t]^F[r],d=F[t+1]^F[r+1],F[t]=c>>>24^d<<8,F[t+1]=d>>>24^c<<8,p(F,e,t),E(F,e,l,u),c=F[n]^F[e],d=F[n+1]^F[e+1],F[n]=c>>>16^d<<16,F[n+1]=d>>>16^c<<16,p(F,r,n),c=F[t]^F[r],d=F[t+1]^F[r+1],F[t]=d>>>31^c<<1,F[t+1]=c>>>31^d<<1}var S=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),I=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3].map((function(e){return 2*e}))),F=new Uint32Array(32),N=new Uint32Array(32);function L(e,t){var r=0;for(r=0;r<16;r++)F[r]=e.h[r],F[r+16]=S[r];for(F[24]=F[24]^e.t,F[25]=F[25]^e.t/4294967296,t&&(F[28]=~F[28],F[29]=~F[29]),r=0;r<32;r++)N[r]=m(e.b,4*r);for(r=0;r<12;r++)v(0,8,16,24,I[16*r+0],I[16*r+1]),v(2,10,18,26,I[16*r+2],I[16*r+3]),v(4,12,20,28,I[16*r+4],I[16*r+5]),v(6,14,22,30,I[16*r+6],I[16*r+7]),v(0,10,20,30,I[16*r+8],I[16*r+9]),v(2,12,22,24,I[16*r+10],I[16*r+11]),v(4,14,16,26,I[16*r+12],I[16*r+13]),v(6,8,18,28,I[16*r+14],I[16*r+15]);for(r=0;r<16;r++)e.h[r]=e.h[r]^F[r]^F[r+16]}function C(e,t){if(0===e||e>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(t&&t.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");for(var r={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:e},n=0;n<16;n++)r.h[n]=S[n];var o=t?t.length:0;return r.h[0]^=16842752^o<<8^e,t&&(G(r,t),r.c=128),r}function G(e,t){for(var r=0;r<t.length;r++)128===e.c&&(e.t+=e.c,L(e,!1),e.c=0),e.b[e.c++]=t[r]}function M(e){for(e.t+=e.c;e.c<128;)e.b[e.c++]=0;L(e,!0);for(var t=new Uint8Array(e.outlen),r=0;r<e.outlen;r++)t[r]=e.h[r>>2]>>8*(3&r);return t}function k(e,t,r){r=r||64,e=_(e);var n=C(r,t);return G(n,e),M(n)}var O={blake2b:k,blake2bHex:function(e,t,r){var n=k(e,t,r);return w(n)},blake2bInit:C,blake2bUpdate:G,blake2bFinal:M};function x(e,t){return e[t]^e[t+1]<<8^e[t+2]<<16^e[t+3]<<24}function U(e,t,r,n,o,s){j[e]=j[e]+j[t]+o,j[n]=R(j[n]^j[e],16),j[r]=j[r]+j[n],j[t]=R(j[t]^j[r],12),j[e]=j[e]+j[t]+s,j[n]=R(j[n]^j[e],8),j[r]=j[r]+j[n],j[t]=R(j[t]^j[r],7)}function R(e,t){return e>>>t^e<<32-t}var P=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),B=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),j=new Uint32Array(16),K=new Uint32Array(16);function D(e,t){var r=0;for(r=0;r<8;r++)j[r]=e.h[r],j[r+8]=P[r];for(j[12]^=e.t,j[13]^=e.t/4294967296,t&&(j[14]=~j[14]),r=0;r<16;r++)K[r]=x(e.b,4*r);for(r=0;r<10;r++)U(0,4,8,12,K[B[16*r+0]],K[B[16*r+1]]),U(1,5,9,13,K[B[16*r+2]],K[B[16*r+3]]),U(2,6,10,14,K[B[16*r+4]],K[B[16*r+5]]),U(3,7,11,15,K[B[16*r+6]],K[B[16*r+7]]),U(0,5,10,15,K[B[16*r+8]],K[B[16*r+9]]),U(1,6,11,12,K[B[16*r+10]],K[B[16*r+11]]),U(2,7,8,13,K[B[16*r+12]],K[B[16*r+13]]),U(3,4,9,14,K[B[16*r+14]],K[B[16*r+15]]);for(r=0;r<8;r++)e.h[r]^=j[r]^j[r+8]}function V(e,t){if(!(e>0&&e<=32))throw new Error("Incorrect output length, should be in [1, 32]");var r=t?t.length:0;if(t&&!(r>0&&r<=32))throw new Error("Incorrect key length, should be in [1, 32]");var n={h:new Uint32Array(P),b:new Uint32Array(64),c:0,t:0,outlen:e};return n.h[0]^=16842752^r<<8^e,r>0&&(q(n,t),n.c=64),n}function q(e,t){for(var r=0;r<t.length;r++)64===e.c&&(e.t+=e.c,D(e,!1),e.c=0),e.b[e.c++]=t[r]}function z(e){for(e.t+=e.c;e.c<64;)e.b[e.c++]=0;D(e,!0);for(var t=new Uint8Array(e.outlen),r=0;r<e.outlen;r++)t[r]=e.h[r>>2]>>8*(3&r)&255;return t}function Y(e,t,r){r=r||32,e=_(e);var n=V(r,t);return q(n,e),z(n)}var W={blake2s:Y,blake2sHex:function(e,t,r){var n=Y(e,t,r);return w(n)},blake2sInit:V,blake2sUpdate:q,blake2sFinal:z},X={blake2b:O.blake2b,blake2bHex:O.blake2bHex,blake2bInit:O.blake2bInit,blake2bUpdate:O.blake2bUpdate,blake2bFinal:O.blake2bFinal,blake2s:W.blake2s,blake2sHex:W.blake2sHex,blake2sInit:W.blake2sInit,blake2sUpdate:W.blake2sUpdate,blake2sFinal:W.blake2sFinal},Z=i((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Blake2b=void 0;class r{static sum256(e){return Buffer.from(X.blake2b(e,void 0,r.SIZE_256))}}t.Blake2b=r,r.SIZE_256=32})),$=i((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.parseMessage=void 0,t.parseMessage=function(e,t,r){const n=u.TrytesHelper.toTrits(e),o=u.TrytesHelper.toTrits(t),s=u.TrytesHelper.toTrits(null!=r?r:"9".repeat(81)),i=T.pascalDecode(n),l=i.value,d=T.pascalDecode(n.slice(i.end)),f=d.value,H=i.end+d.end,y=H+a.Curl.HASH_LENGTH,b=y+f,g=new a.Curl(27);g.absorb(s,0,s.length),g.absorb(o,0,o.length),g.absorb(n,0,H);const _=A.unmask(n.slice(H,H+a.Curl.HASH_LENGTH),g),w=A.unmask(n.slice(y,y+f),g),p=A.unmask(n.slice(b,b+a.Curl.HASH_LENGTH/3),g),E=g.rate(),m=c.checksumSecurity(E);if(0===m)throw new Error("Message Hash did not have a hamming weight of zero, security level is invalid");const v=A.unmask(n.slice(b+p.length),g);g.reset();const S=v.slice(0,m*c.PRIVATE_KEY_FRAGMENT_LENGTH),I=c.digestFromSignature(E,S);g.absorb(I,0,I.length);const F=T.pascalDecode(v.slice(m*c.PRIVATE_KEY_FRAGMENT_LENGTH)),N=F.value;let L=g.rate();if(0!==N){const e=m*c.PRIVATE_KEY_FRAGMENT_LENGTH+F.end,t=v.slice(e,e+N*a.Curl.HASH_LENGTH);L=h.MerkleTree.root(L,t,l)}if(u.TrytesHelper.fromTrits(L)!==t)throw new Error("Signature did not match expected root");return{nextRoot:u.TrytesHelper.fromTrits(_),message:u.TrytesHelper.fromTrits(w)}}})),J=i((function(e,t){var r=s&&s.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,s){function i(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}l((n=n.apply(e,t||[])).next())}))};function n(e,t,n,s){return r(this,void 0,void 0,(function*(){b.validateModeKey(n,s);const r=o(t,n),a=yield e.messagesFind(Z.Blake2b.sum256(Buffer.from(r)).toString("hex")),l=[];for(const t of a.messageIds){const r=yield e.message(t);r&&l.push(r)}return i(l,t,s)}))}function o(e,t){return"public"===t?e:u.TrytesHelper.fromTrits(A.maskHash(u.TrytesHelper.toTrits(e)))}function i(e,t,n){return r(this,void 0,void 0,(function*(){if(e&&0!==e.length)for(const r of e)if(r.payload&&2===r.payload.type){const e=Buffer.from(r.payload.data,"hex");if(e.length>100){const r=e.readUInt8(0);if(0===r||r>27)return;const o=e.slice(1,1+r).toString(),s=e.slice(1+r).toString();try{const e=$.parseMessage(s,t,n);return Object.assign(Object.assign({root:t},e),{tag:o})}catch(e){}}}}))}Object.defineProperty(t,"__esModule",{value:!0}),t.decodeMessages=t.mamFetchAll=t.decodeAddress=t.mamFetch=t.mamAttach=void 0,t.mamAttach=function(e,t,n){return r(this,void 0,void 0,(function*(){if(void 0!==n&&"string"!=typeof n)throw new Error("MWM and depth are no longer needed when calling mamAttach");const r=n?n.length:0,o=Buffer.alloc(1+r+t.payload.length);o.writeUInt8(r,0),n&&o.write(n,1,"ascii"),o.write(t.payload,1+r,"ascii");const s={type:2,index:Z.Blake2b.sum256(Buffer.from(t.address)).toString("hex"),data:o.toString("hex")},i=yield e.tips(),a={version:1,parent1MessageId:i.tip1MessageId,parent2MessageId:i.tip2MessageId,payload:s,nonce:0};return{message:a,messageId:yield e.messageSubmit(a)}}))},t.mamFetch=n,t.decodeAddress=o,t.mamFetchAll=function(e,t,o,s,i){return r(this,void 0,void 0,(function*(){b.validateModeKey(o,s);const r=void 0===i?Number.MAX_VALUE:i,a=[];let l=t;do{const t=yield n(e,l,o,s);t?(a.push(t),l=t.nextRoot):l=void 0}while(l&&a.length<r);return a}))},t.decodeMessages=i})),Q=i((function(e,t){Object.defineProperty(t,"__esModule",{value:!0})})),ee=i((function(e,t){Object.defineProperty(t,"__esModule",{value:!0})})),te=i((function(e,t){Object.defineProperty(t,"__esModule",{value:!0})})),re=i((function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}));return function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}(i((function(e,t){var r=s&&s.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=s&&s.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.SingleNodeClient=void 0,Object.defineProperty(t,"SingleNodeClient",{enumerable:!0,get:function(){return n.default.SingleNodeClient}}),o(g,t),o(J,t),o($,t),o(Q,t),o(ee,t),o(te,t),o(re,t),o(u,t)})))}));