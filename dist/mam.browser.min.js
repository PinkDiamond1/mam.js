!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@iota/iota.js"),require("big-integer")):"function"==typeof define&&define.amd?define(["@iota/iota.js","big-integer"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).mam=t(e.Iota,e.bigInt)}(this,(function(e,t){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=r(e),s=r(t),o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function l(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function a(e){var t={exports:{}};return e(t,t.exports),t.exports}var i=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.TextHelper=void 0;t.TextHelper=class{static encodeNonASCII(e){return"string"==typeof e?e.replace(/[\u007F-\uFFFF]/g,(e=>`\\u${`0000${e.charCodeAt(0).toString(16)}`.slice(-4)}`)):void 0}static decodeNonASCII(e){return"string"==typeof e?e.replace(/\\u(\w{4})/gi,((e,t)=>String.fromCharCode(Number.parseInt(t,16)))):void 0}}})),u=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.TrytesHelper=void 0;class r{static isHash(e){return/^[9A-Z]{81}$/.test(e)}static isTag(e){return/^[9A-Z]{27}$/.test(e)}static isTrytes(e){return/^[9A-Z]+$/.test(e)}static toTrits(e){const t=new Int8Array(3*e.length);for(let n=0;n<e.length;n++){const s=r.ALPHABET.indexOf(e.charAt(n));t[3*n]=r.TRYTES_TRITS[s][0],t[3*n+1]=r.TRYTES_TRITS[s][1],t[3*n+2]=r.TRYTES_TRITS[s][2]}return t}static fromTrits(e){let t="";for(let n=0;n<e.length;n+=3)for(let s=0;s<r.ALPHABET.length;s++)if(r.TRYTES_TRITS[s][0]===e[n]&&r.TRYTES_TRITS[s][1]===e[n+1]&&r.TRYTES_TRITS[s][2]===e[n+2]){t+=r.ALPHABET.charAt(s);break}return t}static tritsValue(e){let t=0;for(let r=e.length-1;r>=0;r--)t=3*t+e[r];return t}static fromAscii(e){let t="";for(let n=0;n<e.length;n++){const s=e.charCodeAt(n),o=s%27,l=(s-o)/27;t+=r.ALPHABET[o]+r.ALPHABET[l]}return t}static toAscii(e){const t=e;if(t.length%2==1)throw new Error("The trytes length must be an even number");let n="";for(let e=0;e<t.length;e+=2){const s=r.ALPHABET.indexOf(t[e])+27*r.ALPHABET.indexOf(t[e+1]);n+=String.fromCharCode(s)}return n}static objectToTrytes(e){const t=JSON.stringify(e),n=i.TextHelper.encodeNonASCII(t);return n?r.fromAscii(n):""}static objectFromTrytes(e){if("string"!=typeof e)throw new TypeError("fromTrytes can only convert strings");const t=e.replace(/\9+$/,"");if(0===t.length)throw new Error("fromTrytes trytes does not contain any data");const n=r.toAscii(t),s=i.TextHelper.decodeNonASCII(n);return s?JSON.parse(s):void 0}static stringToTrytes(e){const t=i.TextHelper.encodeNonASCII(e);return t?r.fromAscii(t):""}static stringFromTrytes(e){let t=e.replace(/\9+$/,"");t.length%2==1&&(t+="9");const n=r.toAscii(t);return i.TextHelper.decodeNonASCII(n)}static packTrytes(e){const t=[];for(const n of e)t.push(r.ALPHABET.indexOf(n).toString(2).padStart(5,"0"));let s=t.join("");const o=s.length%8;return o>0&&(s+="1".repeat(8-o)),n.default.Converter.binaryToBytes(s)}static unpackTrytes(e){const t=n.default.Converter.bytesToBinary(e),s=[];for(let e=0;e<t.length;e+=5){const n=t.slice(e,e+5);if(n.length<5||"111111"===n)break;s.push(r.ALPHABET[Number.parseInt(n,2)])}return s.join("")}}t.TrytesHelper=r,r.ALPHABET="9ABCDEFGHIJKLMNOPQRSTUVWXYZ",r.TRYTES_TRITS=[new Int8Array([0,0,0]),new Int8Array([1,0,0]),new Int8Array([-1,1,0]),new Int8Array([0,1,0]),new Int8Array([1,1,0]),new Int8Array([-1,-1,1]),new Int8Array([0,-1,1]),new Int8Array([1,-1,1]),new Int8Array([-1,0,1]),new Int8Array([0,0,1]),new Int8Array([1,0,1]),new Int8Array([-1,1,1]),new Int8Array([0,1,1]),new Int8Array([1,1,1]),new Int8Array([-1,-1,-1]),new Int8Array([0,-1,-1]),new Int8Array([1,-1,-1]),new Int8Array([-1,0,-1]),new Int8Array([0,0,-1]),new Int8Array([1,0,-1]),new Int8Array([-1,1,-1]),new Int8Array([0,1,-1]),new Int8Array([1,1,-1]),new Int8Array([-1,-1,0]),new Int8Array([0,-1,0]),new Int8Array([1,-1,0]),new Int8Array([-1,0,0])]})),c=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.digestFromSignature=t.checksumSecurity=t.signature=t.privateKeyFromSubseed=t.address=t.digestFromSubseed=t.subseed=t.PRIVATE_KEY_FRAGMENT_LENGTH=void 0;t.PRIVATE_KEY_FRAGMENT_LENGTH=27*n.default.Curl.HASH_LENGTH;t.subseed=function(e,t){const r=new n.default.Curl(27),s=e.slice();let o=t;for(;o-- >0;)for(let e=0;e<s.length&&s[e]++>=1;e++)s[e]=-1;r.absorb(s,0,s.length);const l=new Int8Array(n.default.Curl.HASH_LENGTH);return r.squeeze(l,0,l.length),l},t.digestFromSubseed=function(e,r){const s=new n.default.Curl(27),o=new n.default.Curl(27),l=new n.default.Curl(27),a=r*t.PRIVATE_KEY_FRAGMENT_LENGTH/n.default.Curl.HASH_LENGTH,i=new Int8Array(n.default.Curl.HASH_LENGTH);s.absorb(e,0,e.length);for(let e=0;e<a;e++){s.squeeze(i,0,i.length);for(let e=0;e<27;e++)o.reset(),o.absorb(i,0,i.length),o.squeeze(i,0,i.length);l.absorb(i,0,i.length)}return l.squeeze(i,0,i.length),i},t.address=function(e){const t=new n.default.Curl(27);t.absorb(e,0,e.length);const r=new Int8Array(n.default.Curl.HASH_LENGTH);return t.squeeze(r,0,r.length),r},t.privateKeyFromSubseed=function(e,r){const s=r*t.PRIVATE_KEY_FRAGMENT_LENGTH,o=new Int8Array(s),l=new Int8Array(s),a=new n.default.Curl(27);a.absorb(e,0,e.length),a.squeeze(o,0,o.length);for(let e=0;e<s/n.default.Curl.HASH_LENGTH;e++){const t=e*n.default.Curl.HASH_LENGTH;a.reset(),a.absorb(o,t,n.default.Curl.HASH_LENGTH),l.set(a.rate(),t)}return l},t.signature=function(e,t){const r=new Int8Array(t.length),s=new n.default.Curl(27);for(let o=0;o<t.length/n.default.Curl.HASH_LENGTH;o++){let l=t.subarray(o*n.default.Curl.HASH_LENGTH,(o+1)*n.default.Curl.HASH_LENGTH);for(let t=0;t<13-(e[3*o]+3*e[3*o+1]+9*e[3*o+2]);t++)s.reset(),s.absorb(l,0,l.length),l=s.rate();r.set(l,o*n.default.Curl.HASH_LENGTH)}return r},t.checksumSecurity=function(e){const t=e.slice(0,n.default.Curl.HASH_LENGTH/3);let r=0;for(let e=0;e<t.length;e++)r+=t[e];if(0===r)return 1;const s=e.slice(0,2*n.default.Curl.HASH_LENGTH/3);let o=0;for(let e=0;e<s.length;e++)o+=s[e];if(0===o)return 2;let l=0;for(let t=0;t<e.length;t++)l+=e[t];return 0===l?3:0},t.digestFromSignature=function(e,t){const r=new n.default.Curl(27),s=new Int8Array(t.length);for(let o=0;o<t.length/n.default.Curl.HASH_LENGTH;o++){let l=t.slice(o*n.default.Curl.HASH_LENGTH,(o+1)*n.default.Curl.HASH_LENGTH);for(let t=0;t<e[3*o]+3*e[3*o+1]+9*e[3*o+2]- -13;t++)r.reset(),r.absorb(l,0,l.length),l=r.rate();s.set(l,o*n.default.Curl.HASH_LENGTH)}return r.reset(),r.absorb(s,0,s.length),r.rate()}})),d=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.generateAddress=void 0,t.generateAddress=function(e,t,r){const n=c.subseed(e,t),s=c.digestFromSubseed(n,r);return{address:c.address(s),privateKey:c.privateKeyFromSubseed(n,r)}}})),f=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MerkleNode=void 0;t.MerkleNode=class{constructor(e,t,r,n){this.left=e,this.right=t,this.size=(e?e.size:0)+(t?t.size:0),this.addressTrits=r,this.privateKeyTrits=n}}})),h=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MerkleTree=void 0;t.MerkleTree=class{constructor(e,t,r,n){const s=u.TrytesHelper.toTrits(e),o=[];for(let e=0;e<r;e++){const r=d.generateAddress(s,t+e,n);o.push(new f.MerkleNode(void 0,void 0,r.address,r.privateKey)),o[e].size=1}this.root=this.buildTree(o)}static root(e,t,r){const s=new n.default.Curl(27);let o=1;const l=Math.ceil(t.length/n.default.Curl.HASH_LENGTH);for(let a=0;a<l;a++){const l=t.slice(a*n.default.Curl.HASH_LENGTH,(a+1)*n.default.Curl.HASH_LENGTH);s.reset(),0==(o&r)?(s.absorb(e,0,e.length),s.absorb(l,0,l.length)):(s.absorb(l,0,l.length),s.absorb(e,0,e.length)),o<<=1,e=s.rate()}return s.rate()}getSubtree(e){var t;if(1===this.root.size)return{key:(null===(t=this.root.left)||void 0===t?void 0:t.privateKeyTrits)?this.root.left.privateKeyTrits:new Int8Array,leaves:[]};const r=[];let n,s=this.root,o=this.root.size;if(e<o)for(;s;){if(!s.left){n=s.privateKeyTrits;break}o=s.left.size,e<o?(r.push(s.right?s.right:s.left),s=s.left):(r.push(s.left),s=s.right,e-=o)}return r.reverse(),{key:null!=n?n:new Int8Array,leaves:r}}buildTree(e){const t=[];for(let r=0;r<e.length;r+=2){const s=e[r],o=r+1<e.length?e[r+1]:void 0;let l;if(o){const e=new n.default.Curl(27);e.absorb(s.addressTrits,0,s.addressTrits.length),e.absorb(o.addressTrits,0,o.addressTrits.length),l=new Int8Array(n.default.Curl.HASH_LENGTH),e.squeeze(l,0,l.length)}else l=s.addressTrits;t.push(new f.MerkleNode(s,o,l,void 0))}return 1===t.length?t[0]:this.buildTree(t)}}})),T=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.roundThird=t.pascalDecode=t.pascalEncode=void 0;const r=new Int8Array([1,0,0,-1]);function n(e){const t=e%3;return 0===t?e:e+3-t}function s(e,t){return e<=t?1:1+s(e,1+3*t)}function o(e){return u.TrytesHelper.tritsValue(e.slice(0,3))>0?3:3+o(e.slice(3))}function l(e,t){const r=a(e,t,0);if(e>=0)return r;for(let e=0;e<t.length;e++)t[e]=-t[e];return r}function a(e,t,r){switch(e){case 0:return 0;default:let n=Math.floor(e/3),s=e%3;return s>1&&(n+=1,s=-1),t[r]=s,1+a(n,t,++r)}}t.pascalEncode=function(e){if(0===e)return r;const t=n(s(Math.abs(e),1)),o=new Int8Array(function(e){const t=n(s(Math.abs(e),1));return t+t/3}(e));l(e,o);let a=0,i=0;for(let e=0;e<t-3;e+=3){const t=o.slice(e,e+3);if(u.TrytesHelper.tritsValue(t)>=0){a|=1<<i;for(let r=0;r<t.length;r++)o[e+r]=-t[r]}i++}const c=o.slice(t-3,t-3+t);if(u.TrytesHelper.tritsValue(c)<0){a|=1<<i;for(let e=0;e<c.length;e++)o[e+t-3]=-o[e+t-3]}const d=new Int8Array(o.length-t);l(a,d);for(let e=0;e<d.length;e++)o[t+e]=d[e];return o},t.pascalDecode=function(e){if(e.length>=r.length&&e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3])return{value:0,end:4};const t=o(e),n=t+t/3,s=u.TrytesHelper.tritsValue(e.slice(t,n));let l=0;for(let r=0;r<t/3;r++){const t=0!=(s>>r&1)?-u.TrytesHelper.tritsValue(e.slice(3*r,3*(r+1))):u.TrytesHelper.tritsValue(e.slice(3*r,3*(r+1)));l+=Math.pow(27,r)*t}return{value:l,end:n}},t.roundThird=n})),H=a((function(e,t){var r=o&&o.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.HammingDiver=void 0;const l=r(s.default);class a{search(e,t,r,s){const o=this.prepareTrits(e,s);let l=Math.min(r,n.default.Curl.HASH_LENGTH)-s,a=0;for(;0===a;){const e=this.increment(o,s+2*l/3,s+l);l=Math.min(T.roundThird(s+2*l/3+e),n.default.Curl.HASH_LENGTH)-s;const r={low:o.low.slice(),high:o.high.slice()};this.transform(r),a=this.check(t,r.low,r.high)}return this.trinaryGet(o.low,o.high,l,a)}prepareTrits(e,t){const r=this.tritsToBigInt(e,n.default.Curl.STATE_LENGTH);return r.low[t]=a.LOW_0,r.low[t+1]=a.LOW_1,r.low[t+2]=a.LOW_2,r.low[t+3]=a.LOW_3,r.high[t]=a.HIGH_0,r.high[t+1]=a.HIGH_1,r.high[t+2]=a.HIGH_2,r.high[t+3]=a.HIGH_3,r}tritsToBigInt(e,t){const r={low:[],high:[]};for(let t=0;t<e.length;t++)switch(e[t]){case 0:r.low[t]=a.MAX_VALUE,r.high[t]=a.MAX_VALUE;break;case 1:r.low[t]=a.MIN_VALUE,r.high[t]=a.MAX_VALUE;break;default:r.low[t]=a.MAX_VALUE,r.high[t]=a.MIN_VALUE}if(e.length>=t)return r;for(let n=e.length;n<t;n++)r.low[n]=a.MAX_VALUE,r.high[n]=a.MAX_VALUE;return r}increment(e,t,r){for(let n=t;n<r;n++){const s=e.low[n],o=e.high[n];if(e.low[n]=o.xor(s),e.high[n]=s,o.and(s.not()).equals(0))return r-t}return r-t+1}transform(e){let t=0;for(let r=0;r<a.ROUNDS;r++){const r={low:e.low.slice(0,n.default.Curl.STATE_LENGTH),high:e.high.slice(0,n.default.Curl.STATE_LENGTH)};for(let s=0;s<n.default.Curl.STATE_LENGTH;s++){const n=r.low[t],o=r.high[t];t+=t<365?364:-365;const l=r.high[t],a=r.low[t].xor(o),i=this.bitWiseNot(l),u=n.or(i).and(a);e.low[s]=this.bitWiseNot(u);const c=n.xor(l);e.high[s]=c.or(u)}}}bitWiseNot(e){return l.default(1).shiftLeft(64).subtract(l.default(1)).subtract(e)}check(e,t,r){for(let n=0;n<64;n++){let s=0;for(let o=0;o<e;o++){for(let e=243*o/3;e<243*(o+1)/3;e++){const o=l.default(1).shiftLeft(n);t[e].and(o).equals(0)?s--:r[e].and(o).equals(0)&&s++}if(0===s&&o<e-1){s=1;break}}if(0===s)return n}return 0}trinaryGet(e,t,r,n){const s=new Int8Array(r);for(let o=0;o<r;o++){const r=l.default(n),a=e[o].shiftRight(r).and(1),i=t[o].shiftRight(r).and(1);a.equals(1)&&i.equals(0)?s[o]=-1:a.equals(0)&&i.equals(1)?s[o]=1:s[o]=0}return s}}t.HammingDiver=a,a.MAX_VALUE=l.default("FFFFFFFFFFFFFFFF",16),a.MIN_VALUE=l.default("0000000000000000",16),a.HIGH_0=l.default("B6DB6DB6DB6DB6DB",16),a.HIGH_1=l.default("8FC7E3F1F8FC7E3F",16),a.HIGH_2=l.default("FFC01FFFF803FFFF",16),a.HIGH_3=l.default("003FFFFFFFFFFFFF",16),a.LOW_0=l.default("DB6DB6DB6DB6DB6D",16),a.LOW_1=l.default("F1F8FC7E3F1F8FC7",16),a.LOW_2=l.default("7FFFE00FFFFC01FF",16),a.LOW_3=l.default("FFC0000007FFFFFF",16),a.ROUNDS=27})),y=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.concatenate=void 0,t.concatenate=function(e){let t=0;for(const r of e)t+=r.length;const r=new Int8Array(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return r}})),g=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.validateModeKey=void 0,t.validateModeKey=function(e,t){if("public"!==e&&"private"!==e&&"restricted"!==e)throw new Error(`The mode must be public, private or restricted, it is '${e}'`);if("restricted"===e){if(!t)throw new Error("You must provide a sideKey for restricted mode");if(!u.TrytesHelper.isTrytes(t))throw new Error("The sideKey must be in trytes");if(t.length>81)throw new Error("The sideKey must be maximum length 81 trytes")}if("restricted"!==e&&t)throw new Error("sideKey is only used in restricted mode")}})),A=a((function(e,t){function r(e,t){const r=e+t;switch(r){case 2:return-1;case-2:return 1;default:return r}}Object.defineProperty(t,"__esModule",{value:!0}),t.unmask=t.mask=t.maskHash=void 0,t.maskHash=function(e){const t=new n.default.Curl(81);t.absorb(e,0,e.length);const r=new Int8Array(n.default.Curl.HASH_LENGTH);return t.squeeze(r,0,r.length),r},t.mask=function(e,t){const s=t.rate(),o=Math.ceil(e.length/n.default.Curl.HASH_LENGTH);for(let l=0;l<o;l++){const o=e.slice(l*n.default.Curl.HASH_LENGTH,(l+1)*n.default.Curl.HASH_LENGTH);t.absorb(o,0,o.length);const a=t.rate();for(let t=0;t<o.length;t++)e[l*n.default.Curl.HASH_LENGTH+t]=r(o[t],s[t]),s[t]=a[t]}return e},t.unmask=function(e,t){const s=new Int8Array(e),o=Math.ceil(s.length/n.default.Curl.HASH_LENGTH)*n.default.Curl.HASH_LENGTH;let l;for(let e=0;e<o;e++){const o=e%n.default.Curl.HASH_LENGTH;0===o&&(l=t.rate()),l&&(s[e]=r(s[e],-l[o])),o===n.default.Curl.HASH_LENGTH-1&&t.absorb(s,Math.floor(e/n.default.Curl.HASH_LENGTH)*n.default.Curl.HASH_LENGTH,n.default.Curl.HASH_LENGTH)}return s}})),p=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createMessage=t.channelRoot=t.createChannel=void 0,t.createChannel=function(e,t,r,n){if(!u.TrytesHelper.isHash(e))throw new Error("The seed must be 81 trytes long");if(t<1||t>3)throw new Error(`Security must be between 1 and 3, it is ${t}`);return g.validateModeKey(r,n),{seed:e,mode:r,sideKey:"restricted"===r?(null!=n?n:"").padEnd(81,"9"):void 0,security:t,start:0,count:1,nextCount:1,index:0}},t.channelRoot=function(e){if(!e)throw new Error("channelState must be provided");if(e.start<0)throw new Error("channelState.start must be >= 0");if(e.count<=0)throw new Error("channelState.count must be > 0");if(e.security<1||e.security>3)throw new Error(`channelState.security must be between 1 and 3, it is ${e.security}`);const t=new h.MerkleTree(e.seed,e.start,e.count,e.security);return u.TrytesHelper.fromTrits(t.root.addressTrits)},t.createMessage=function(e,t){var r;if(!u.TrytesHelper.isTrytes(t))throw new Error("The message must be in trytes");const s=new h.MerkleTree(e.seed,e.start,e.count,e.security),o=new h.MerkleTree(e.seed,e.start+e.count,e.nextCount,e.security).root.addressTrits,l=u.TrytesHelper.toTrits(t),a=T.pascalEncode(e.index),i=T.pascalEncode(l.length),d=s.getSubtree(e.index),f=new n.default.Curl(27),g=u.TrytesHelper.toTrits(null!==(r=e.sideKey)&&void 0!==r?r:"9".repeat(81));f.absorb(g,0,g.length),f.absorb(s.root.addressTrits,0,s.root.addressTrits.length);let p=y.concatenate([a,i]);f.absorb(p,0,p.length);const _=A.mask(y.concatenate([o,l]),f);p=y.concatenate([p,_]);const b=(new H.HammingDiver).search(f.rate(n.default.Curl.STATE_LENGTH),e.security,n.default.Curl.HASH_LENGTH/3,0);A.mask(b,f),p=y.concatenate([p,b]);const w=c.signature(f.rate(),d.key),E=y.concatenate(d.leaves.map((e=>e.addressTrits))),m=E.length/n.default.Curl.HASH_LENGTH,v=A.mask(y.concatenate([w,T.pascalEncode(m),E]),f);p=y.concatenate([p,v]);const S=p.length%3;0!==S&&(p=y.concatenate([p,new Int8Array(3-S).fill(0)]));const F="public"===e.mode?s.root.addressTrits:A.maskHash(s.root.addressTrits),I={payload:u.TrytesHelper.fromTrits(p),root:u.TrytesHelper.fromTrits(s.root.addressTrits),address:u.TrytesHelper.fromTrits(F)};return e.index===e.count-1?(e.start=e.nextCount+e.start,e.index=0):e.index++,e.nextRoot=u.TrytesHelper.fromTrits(o),I}})),_=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.parseMessage=void 0,t.parseMessage=function(e,t,r){const s=u.TrytesHelper.toTrits(e),o=u.TrytesHelper.toTrits(t),l=u.TrytesHelper.toTrits(null!=r?r:"9".repeat(81)),a=T.pascalDecode(s),i=a.value,d=T.pascalDecode(s.slice(a.end)),f=d.value,H=a.end+d.end,y=H+n.default.Curl.HASH_LENGTH,g=y+f,p=new n.default.Curl(27);p.absorb(l,0,l.length),p.absorb(o,0,o.length),p.absorb(s,0,H);const _=A.unmask(s.slice(H,H+n.default.Curl.HASH_LENGTH),p),b=A.unmask(s.slice(y,y+f),p),w=A.unmask(s.slice(g,g+n.default.Curl.HASH_LENGTH/3),p),E=p.rate(),m=c.checksumSecurity(E);if(0===m)throw new Error("Message Hash did not have a hamming weight of zero, security level is invalid");const v=A.unmask(s.slice(g+w.length),p);p.reset();const S=v.slice(0,m*c.PRIVATE_KEY_FRAGMENT_LENGTH),F=c.digestFromSignature(E,S);p.absorb(F,0,F.length);const I=T.pascalDecode(v.slice(m*c.PRIVATE_KEY_FRAGMENT_LENGTH)),C=I.value;let N=p.rate();if(0!==C){const e=m*c.PRIVATE_KEY_FRAGMENT_LENGTH+I.end,t=v.slice(e,e+C*n.default.Curl.HASH_LENGTH);N=h.MerkleTree.root(N,t,i)}if(u.TrytesHelper.fromTrits(N)!==t)throw new Error("Signature did not match expected root");return{nextRoot:u.TrytesHelper.fromTrits(_),message:u.TrytesHelper.fromTrits(b)}}})),b=a((function(e,t){var r=o&&o.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,o){function l(e){try{i(n.next(e))}catch(e){o(e)}}function a(e){try{i(n.throw(e))}catch(e){o(e)}}function i(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(l,a)}i((n=n.apply(e,t||[])).next())}))};function s(e,t,s,o){return r(this,void 0,void 0,(function*(){g.validateModeKey(s,o);const r="string"==typeof e?new n.default.SingleNodeClient(e):e,i=l(t,s),u=n.default.Blake2b.sum256(n.default.Converter.utf8ToBytes(i));try{const e=yield r.messagesFind(u),n=[];for(const t of e.messageIds)try{const e=yield r.message(t);n.push(e)}catch(e){}return yield a(n,t,o)}catch(e){}}))}function l(e,t){return"public"===t?e:u.TrytesHelper.fromTrits(A.maskHash(u.TrytesHelper.toTrits(e)))}function a(e,t,s){var o;return r(this,void 0,void 0,(function*(){if(e&&0!==e.length)for(const r of e)if((null===(o=r.payload)||void 0===o?void 0:o.type)===n.default.INDEXATION_PAYLOAD_TYPE&&r.payload.data){const e=n.default.Converter.hexToBytes(r.payload.data);if(e.length>100){const r=e[0],n=r>0?e.slice(1,1+r):void 0,o=e.slice(1+r),l=n?u.TrytesHelper.unpackTrytes(n):"",a=u.TrytesHelper.unpackTrytes(o);try{const e=_.parseMessage(a,t,s);return Object.assign(Object.assign({root:t},e),{tag:l})}catch(e){}}}}))}Object.defineProperty(t,"__esModule",{value:!0}),t.decodeMessages=t.mamFetchAll=t.decodeAddress=t.mamFetch=t.mamAttach=void 0,t.mamAttach=function(e,t,s){return r(this,void 0,void 0,(function*(){if(void 0!==s&&"string"!=typeof s)throw new Error("MWM and depth are no longer needed when calling mamAttach");if((s?s.length:0)>27)throw new Error("The tag length is too long");const r=s?u.TrytesHelper.packTrytes(s):void 0,o=r?r.length:0,l=u.TrytesHelper.packTrytes(t.payload),a=new Uint8Array(1+o+l.length);a[0]=o,r&&a.set(r,1),a.set(l,1+o);const i=n.default.Blake2b.sum256(n.default.Converter.utf8ToBytes(t.address)),c={payload:{type:n.default.INDEXATION_PAYLOAD_TYPE,index:n.default.Converter.bytesToHex(i),data:n.default.Converter.bytesToHex(a)}},d="string"==typeof e?new n.default.SingleNodeClient(e):e;return{message:c,messageId:yield d.messageSubmit(c)}}))},t.mamFetch=s,t.decodeAddress=l,t.mamFetchAll=function(e,t,o,l,a){return r(this,void 0,void 0,(function*(){const r="string"==typeof e?new n.default.SingleNodeClient(e):e;g.validateModeKey(o,l);const i=void 0===a?Number.MAX_VALUE:a,u=[];let c=t;do{const e=yield s(r,c,o,l);e?(u.push(e),c=e.nextRoot):c=void 0}while(c&&u.length<i);return u}))},t.decodeMessages=a})),w=Object.defineProperty({},"__esModule",{value:!0}),E=Object.defineProperty({},"__esModule",{value:!0}),m=Object.defineProperty({},"__esModule",{value:!0}),v=Object.defineProperty({},"__esModule",{value:!0});return l(a((function(e,t){var r=o&&o.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),n=o&&o.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),n(p,t),n(b,t),n(_,t),n(w,t),n(E,t),n(m,t),n(v,t),n(u,t)})))}));