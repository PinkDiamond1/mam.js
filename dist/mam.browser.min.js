!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@iota/iota.js"),require("big-integer")):"function"==typeof define&&define.amd?define(["@iota/iota.js","big-integer"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).mam=t(e.Iota,e.bigInt)}(this,(function(e,t){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=r(e),o=r(t),s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function l(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function a(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&r.path)}},r.exports),r.exports}var i=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.TextHelper=void 0;t.TextHelper=class{static encodeNonASCII(e){return"string"==typeof e?e.replace(/[\u007F-\uFFFF]/g,(e=>`\\u${`0000${e.charCodeAt(0).toString(16)}`.slice(-4)}`)):void 0}static decodeNonASCII(e){return"string"==typeof e?e.replace(/\\u(\w{4})/gi,((e,t)=>String.fromCharCode(Number.parseInt(t,16)))):void 0}}})),u=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.TrytesHelper=void 0;class r{static isHash(e){return/^[9A-Z]{81}$/.test(e)}static isTag(e){return/^[9A-Z]{27}$/.test(e)}static isTrytes(e){return/^[9A-Z]+$/.test(e)}static toTrits(e){const t=new Int8Array(3*e.length);for(let n=0;n<e.length;n++){const o=r.ALPHABET.indexOf(e.charAt(n));t[3*n]=r.TRYTES_TRITS[o][0],t[3*n+1]=r.TRYTES_TRITS[o][1],t[3*n+2]=r.TRYTES_TRITS[o][2]}return t}static fromTrits(e){let t="";for(let n=0;n<e.length;n+=3)for(let o=0;o<r.ALPHABET.length;o++)if(r.TRYTES_TRITS[o][0]===e[n]&&r.TRYTES_TRITS[o][1]===e[n+1]&&r.TRYTES_TRITS[o][2]===e[n+2]){t+=r.ALPHABET.charAt(o);break}return t}static tritsValue(e){let t=0;for(let r=e.length-1;r>=0;r--)t=3*t+e[r];return t}static fromAscii(e){let t="";for(let n=0;n<e.length;n++){const o=e.charCodeAt(n),s=o%27,l=(o-s)/27;t+=r.ALPHABET[s]+r.ALPHABET[l]}return t}static toAscii(e){const t=e;if(t.length%2==1)throw new Error("The trytes length must be an even number");let n="";for(let e=0;e<t.length;e+=2){const o=r.ALPHABET.indexOf(t[e])+27*r.ALPHABET.indexOf(t[e+1]);n+=String.fromCharCode(o)}return n}static objectToTrytes(e){const t=JSON.stringify(e),n=i.TextHelper.encodeNonASCII(t);return n?r.fromAscii(n):""}static objectFromTrytes(e){if("string"!=typeof e)throw new TypeError("fromTrytes can only convert strings");const t=e.replace(/\9+$/,"");if(0===t.length)throw new Error("fromTrytes trytes does not contain any data");const n=r.toAscii(t),o=i.TextHelper.decodeNonASCII(n);return o?JSON.parse(o):void 0}static stringToTrytes(e){const t=i.TextHelper.encodeNonASCII(e);return t?r.fromAscii(t):""}static stringFromTrytes(e){let t=e.replace(/\9+$/,"");t.length%2==1&&(t+="9");const n=r.toAscii(t);return i.TextHelper.decodeNonASCII(n)}static packTrytes(e){const t=[];for(const n of e)t.push(r.ALPHABET.indexOf(n).toString(2).padStart(5,"0"));let o=t.join("");const s=o.length%8;return s>0&&(o+="1".repeat(8-s)),n.default.Converter.binaryToBytes(o)}static unpackTrytes(e){const t=n.default.Converter.bytesToBinary(e),o=[];for(let e=0;e<t.length;e+=5){const n=t.slice(e,e+5);if(n.length<5||"111111"===n)break;o.push(r.ALPHABET[Number.parseInt(n,2)])}return o.join("")}}t.TrytesHelper=r,r.ALPHABET="9ABCDEFGHIJKLMNOPQRSTUVWXYZ",r.TRYTES_TRITS=[new Int8Array([0,0,0]),new Int8Array([1,0,0]),new Int8Array([-1,1,0]),new Int8Array([0,1,0]),new Int8Array([1,1,0]),new Int8Array([-1,-1,1]),new Int8Array([0,-1,1]),new Int8Array([1,-1,1]),new Int8Array([-1,0,1]),new Int8Array([0,0,1]),new Int8Array([1,0,1]),new Int8Array([-1,1,1]),new Int8Array([0,1,1]),new Int8Array([1,1,1]),new Int8Array([-1,-1,-1]),new Int8Array([0,-1,-1]),new Int8Array([1,-1,-1]),new Int8Array([-1,0,-1]),new Int8Array([0,0,-1]),new Int8Array([1,0,-1]),new Int8Array([-1,1,-1]),new Int8Array([0,1,-1]),new Int8Array([1,1,-1]),new Int8Array([-1,-1,0]),new Int8Array([0,-1,0]),new Int8Array([1,-1,0]),new Int8Array([-1,0,0])]})),c=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.digestFromSignature=t.checksumSecurity=t.signature=t.privateKeyFromSubseed=t.address=t.digestFromSubseed=t.subseed=t.PRIVATE_KEY_FRAGMENT_LENGTH=void 0;t.PRIVATE_KEY_FRAGMENT_LENGTH=27*n.default.Curl.HASH_LENGTH;t.subseed=function(e,t){const r=new n.default.Curl(27),o=e.slice();let s=t;for(;s-- >0;)for(let e=0;e<o.length&&o[e]++>=1;e++)o[e]=-1;r.absorb(o,0,o.length);const l=new Int8Array(n.default.Curl.HASH_LENGTH);return r.squeeze(l,0,l.length),l},t.digestFromSubseed=function(e,r){const o=new n.default.Curl(27),s=new n.default.Curl(27),l=new n.default.Curl(27),a=r*t.PRIVATE_KEY_FRAGMENT_LENGTH/n.default.Curl.HASH_LENGTH,i=new Int8Array(n.default.Curl.HASH_LENGTH);o.absorb(e,0,e.length);for(let e=0;e<a;e++){o.squeeze(i,0,i.length);for(let e=0;e<27;e++)s.reset(),s.absorb(i,0,i.length),s.squeeze(i,0,i.length);l.absorb(i,0,i.length)}return l.squeeze(i,0,i.length),i},t.address=function(e){const t=new n.default.Curl(27);t.absorb(e,0,e.length);const r=new Int8Array(n.default.Curl.HASH_LENGTH);return t.squeeze(r,0,r.length),r},t.privateKeyFromSubseed=function(e,r){const o=r*t.PRIVATE_KEY_FRAGMENT_LENGTH,s=new Int8Array(o),l=new Int8Array(o),a=new n.default.Curl(27);a.absorb(e,0,e.length),a.squeeze(s,0,s.length);for(let e=0;e<o/n.default.Curl.HASH_LENGTH;e++){const t=e*n.default.Curl.HASH_LENGTH;a.reset(),a.absorb(s,t,n.default.Curl.HASH_LENGTH),l.set(a.rate(),t)}return l},t.signature=function(e,t){const r=new Int8Array(t.length),o=new n.default.Curl(27);for(let s=0;s<t.length/n.default.Curl.HASH_LENGTH;s++){let l=t.subarray(s*n.default.Curl.HASH_LENGTH,(s+1)*n.default.Curl.HASH_LENGTH);for(let t=0;t<13-(e[3*s]+3*e[3*s+1]+9*e[3*s+2]);t++)o.reset(),o.absorb(l,0,l.length),l=o.rate();r.set(l,s*n.default.Curl.HASH_LENGTH)}return r},t.checksumSecurity=function(e){const t=e.slice(0,n.default.Curl.HASH_LENGTH/3);let r=0;for(let e=0;e<t.length;e++)r+=t[e];if(0===r)return 1;const o=e.slice(0,2*n.default.Curl.HASH_LENGTH/3);let s=0;for(let e=0;e<o.length;e++)s+=o[e];if(0===s)return 2;let l=0;for(let t=0;t<e.length;t++)l+=e[t];return 0===l?3:0},t.digestFromSignature=function(e,t){const r=new n.default.Curl(27),o=new Int8Array(t.length);for(let s=0;s<t.length/n.default.Curl.HASH_LENGTH;s++){let l=t.slice(s*n.default.Curl.HASH_LENGTH,(s+1)*n.default.Curl.HASH_LENGTH);for(let t=0;t<e[3*s]+3*e[3*s+1]+9*e[3*s+2]- -13;t++)r.reset(),r.absorb(l,0,l.length),l=r.rate();o.set(l,s*n.default.Curl.HASH_LENGTH)}return r.reset(),r.absorb(o,0,o.length),r.rate()}})),d=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.generateAddress=void 0,t.generateAddress=function(e,t,r){const n=c.subseed(e,t),o=c.digestFromSubseed(n,r);return{address:c.address(o),privateKey:c.privateKeyFromSubseed(n,r)}}})),f=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MerkleNode=void 0;t.MerkleNode=class{constructor(e,t,r,n){this.left=e,this.right=t,this.size=(e?e.size:0)+(t?t.size:0),this.addressTrits=r,this.privateKeyTrits=n}}})),h=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MerkleTree=void 0;t.MerkleTree=class{constructor(e,t,r,n){const o=u.TrytesHelper.toTrits(e),s=[];for(let e=0;e<r;e++){const r=d.generateAddress(o,t+e,n);s.push(new f.MerkleNode(void 0,void 0,r.address,r.privateKey)),s[e].size=1}this.root=this.buildTree(s)}static root(e,t,r){const o=new n.default.Curl(27);let s=1;const l=Math.ceil(t.length/n.default.Curl.HASH_LENGTH);for(let a=0;a<l;a++){const l=t.slice(a*n.default.Curl.HASH_LENGTH,(a+1)*n.default.Curl.HASH_LENGTH);o.reset(),0==(s&r)?(o.absorb(e,0,e.length),o.absorb(l,0,l.length)):(o.absorb(l,0,l.length),o.absorb(e,0,e.length)),s<<=1,e=o.rate()}return o.rate()}getSubtree(e){var t;if(1===this.root.size)return{key:(null===(t=this.root.left)||void 0===t?void 0:t.privateKeyTrits)?this.root.left.privateKeyTrits:new Int8Array,leaves:[]};const r=[];let n,o=this.root,s=this.root.size;if(e<s)for(;o;){if(!o.left){n=o.privateKeyTrits;break}s=o.left.size,e<s?(r.push(o.right?o.right:o.left),o=o.left):(r.push(o.left),o=o.right,e-=s)}return r.reverse(),{key:null!=n?n:new Int8Array,leaves:r}}buildTree(e){const t=[];for(let r=0;r<e.length;r+=2){const o=e[r],s=r+1<e.length?e[r+1]:void 0;let l;if(s){const e=new n.default.Curl(27);e.absorb(o.addressTrits,0,o.addressTrits.length),e.absorb(s.addressTrits,0,s.addressTrits.length),l=new Int8Array(n.default.Curl.HASH_LENGTH),e.squeeze(l,0,l.length)}else l=o.addressTrits;t.push(new f.MerkleNode(o,s,l,void 0))}return 1===t.length?t[0]:this.buildTree(t)}}})),T=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.roundThird=t.pascalDecode=t.pascalEncode=void 0;const r=new Int8Array([1,0,0,-1]);function n(e){const t=e%3;return 0===t?e:e+3-t}function o(e,t){return e<=t?1:1+o(e,1+3*t)}function s(e){return u.TrytesHelper.tritsValue(e.slice(0,3))>0?3:3+s(e.slice(3))}function l(e,t){const r=a(e,t,0);if(e>=0)return r;for(let e=0;e<t.length;e++)t[e]=-t[e];return r}function a(e,t,r){switch(e){case 0:return 0;default:let n=Math.floor(e/3),o=e%3;return o>1&&(n+=1,o=-1),t[r]=o,1+a(n,t,++r)}}t.pascalEncode=function(e){if(0===e)return r;const t=n(o(Math.abs(e),1)),s=new Int8Array(function(e){const t=n(o(Math.abs(e),1));return t+t/3}(e));l(e,s);let a=0,i=0;for(let e=0;e<t-3;e+=3){const t=s.slice(e,e+3);if(u.TrytesHelper.tritsValue(t)>=0){a|=1<<i;for(let r=0;r<t.length;r++)s[e+r]=-t[r]}i++}const c=s.slice(t-3,t-3+t);if(u.TrytesHelper.tritsValue(c)<0){a|=1<<i;for(let e=0;e<c.length;e++)s[e+t-3]=-s[e+t-3]}const d=new Int8Array(s.length-t);l(a,d);for(let e=0;e<d.length;e++)s[t+e]=d[e];return s},t.pascalDecode=function(e){if(e.length>=r.length&&e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3])return{value:0,end:4};const t=s(e),n=t+t/3,o=u.TrytesHelper.tritsValue(e.slice(t,n));let l=0;for(let r=0;r<t/3;r++){const t=0!=(o>>r&1)?-u.TrytesHelper.tritsValue(e.slice(3*r,3*(r+1))):u.TrytesHelper.tritsValue(e.slice(3*r,3*(r+1)));l+=Math.pow(27,r)*t}return{value:l,end:n}},t.roundThird=n})),y=a((function(e,t){var r=s&&s.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.HammingDiver=void 0;const l=r(o.default);class a{search(e,t,r,o){const s=this.prepareTrits(e,o);let l=Math.min(r,n.default.Curl.HASH_LENGTH)-o,a=0;for(;0===a;){const e=this.increment(s,o+2*l/3,o+l);l=Math.min(T.roundThird(o+2*l/3+e),n.default.Curl.HASH_LENGTH)-o;const r={low:s.low.slice(),high:s.high.slice()};this.transform(r),a=this.check(t,r.low,r.high)}return this.trinaryGet(s.low,s.high,l,a)}prepareTrits(e,t){const r=this.tritsToBigInt(e,n.default.Curl.STATE_LENGTH);return r.low[t]=a.LOW_0,r.low[t+1]=a.LOW_1,r.low[t+2]=a.LOW_2,r.low[t+3]=a.LOW_3,r.high[t]=a.HIGH_0,r.high[t+1]=a.HIGH_1,r.high[t+2]=a.HIGH_2,r.high[t+3]=a.HIGH_3,r}tritsToBigInt(e,t){const r={low:[],high:[]};for(let t=0;t<e.length;t++)switch(e[t]){case 0:r.low[t]=a.MAX_VALUE,r.high[t]=a.MAX_VALUE;break;case 1:r.low[t]=a.MIN_VALUE,r.high[t]=a.MAX_VALUE;break;default:r.low[t]=a.MAX_VALUE,r.high[t]=a.MIN_VALUE}if(e.length>=t)return r;for(let n=e.length;n<t;n++)r.low[n]=a.MAX_VALUE,r.high[n]=a.MAX_VALUE;return r}increment(e,t,r){for(let n=t;n<r;n++){const o=e.low[n],s=e.high[n];if(e.low[n]=s.xor(o),e.high[n]=o,s.and(o.not()).equals(0))return r-t}return r-t+1}transform(e){let t=0;for(let r=0;r<a.ROUNDS;r++){const r={low:e.low.slice(0,n.default.Curl.STATE_LENGTH),high:e.high.slice(0,n.default.Curl.STATE_LENGTH)};for(let o=0;o<n.default.Curl.STATE_LENGTH;o++){const n=r.low[t],s=r.high[t];t+=t<365?364:-365;const l=r.high[t],a=r.low[t].xor(s),i=this.bitWiseNot(l),u=n.or(i).and(a);e.low[o]=this.bitWiseNot(u);const c=n.xor(l);e.high[o]=c.or(u)}}}bitWiseNot(e){return l.default(1).shiftLeft(64).subtract(l.default(1)).subtract(e)}check(e,t,r){for(let n=0;n<64;n++){let o=0;for(let s=0;s<e;s++){for(let e=243*s/3;e<243*(s+1)/3;e++){const s=l.default(1).shiftLeft(n);t[e].and(s).equals(0)?o--:r[e].and(s).equals(0)&&o++}if(0===o&&s<e-1){o=1;break}}if(0===o)return n}return 0}trinaryGet(e,t,r,n){const o=new Int8Array(r);for(let s=0;s<r;s++){const r=l.default(n),a=e[s].shiftRight(r).and(1),i=t[s].shiftRight(r).and(1);a.equals(1)&&i.equals(0)?o[s]=-1:a.equals(0)&&i.equals(1)?o[s]=1:o[s]=0}return o}}t.HammingDiver=a,a.MAX_VALUE=l.default("FFFFFFFFFFFFFFFF",16),a.MIN_VALUE=l.default("0000000000000000",16),a.HIGH_0=l.default("B6DB6DB6DB6DB6DB",16),a.HIGH_1=l.default("8FC7E3F1F8FC7E3F",16),a.HIGH_2=l.default("FFC01FFFF803FFFF",16),a.HIGH_3=l.default("003FFFFFFFFFFFFF",16),a.LOW_0=l.default("DB6DB6DB6DB6DB6D",16),a.LOW_1=l.default("F1F8FC7E3F1F8FC7",16),a.LOW_2=l.default("7FFFE00FFFFC01FF",16),a.LOW_3=l.default("FFC0000007FFFFFF",16),a.ROUNDS=27})),H=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.concatenate=void 0,t.concatenate=function(e){let t=0;for(const r of e)t+=r.length;const r=new Int8Array(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return r}})),g=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.validateModeKey=void 0,t.validateModeKey=function(e,t){if("public"!==e&&"private"!==e&&"restricted"!==e)throw new Error(`The mode must be public, private or restricted, it is '${e}'`);if("restricted"===e){if(!t)throw new Error("You must provide a sideKey for restricted mode");if(!u.TrytesHelper.isTrytes(t))throw new Error("The sideKey must be in trytes");if(t.length>81)throw new Error("The sideKey must be maximum length 81 trytes")}if("restricted"!==e&&t)throw new Error("sideKey is only used in restricted mode")}})),A=a((function(e,t){function r(e,t){const r=e+t;switch(r){case 2:return-1;case-2:return 1;default:return r}}Object.defineProperty(t,"__esModule",{value:!0}),t.unmask=t.mask=t.maskHash=void 0,t.maskHash=function(e){const t=new n.default.Curl(81);t.absorb(e,0,e.length);const r=new Int8Array(n.default.Curl.HASH_LENGTH);return t.squeeze(r,0,r.length),r},t.mask=function(e,t){const o=t.rate(),s=Math.ceil(e.length/n.default.Curl.HASH_LENGTH);for(let l=0;l<s;l++){const s=e.slice(l*n.default.Curl.HASH_LENGTH,(l+1)*n.default.Curl.HASH_LENGTH);t.absorb(s,0,s.length);const a=t.rate();for(let t=0;t<s.length;t++)e[l*n.default.Curl.HASH_LENGTH+t]=r(s[t],o[t]),o[t]=a[t]}return e},t.unmask=function(e,t){const o=new Int8Array(e),s=Math.ceil(o.length/n.default.Curl.HASH_LENGTH)*n.default.Curl.HASH_LENGTH;let l;for(let e=0;e<s;e++){const s=e%n.default.Curl.HASH_LENGTH;0===s&&(l=t.rate()),l&&(o[e]=r(o[e],-l[s])),s===n.default.Curl.HASH_LENGTH-1&&t.absorb(o,Math.floor(e/n.default.Curl.HASH_LENGTH)*n.default.Curl.HASH_LENGTH,n.default.Curl.HASH_LENGTH)}return o}})),p=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createMessage=t.channelRoot=t.createChannel=void 0,t.createChannel=function(e,t,r,n){if(!u.TrytesHelper.isHash(e))throw new Error("The seed must be 81 trytes long");if(t<1||t>3)throw new Error(`Security must be between 1 and 3, it is ${t}`);return g.validateModeKey(r,n),{seed:e,mode:r,sideKey:"restricted"===r?(null!=n?n:"").padEnd(81,"9"):void 0,security:t,start:0,count:1,nextCount:1,index:0}},t.channelRoot=function(e){if(!e)throw new Error("channelState must be provided");if(e.start<0)throw new Error("channelState.start must be >= 0");if(e.count<=0)throw new Error("channelState.count must be > 0");if(e.security<1||e.security>3)throw new Error(`channelState.security must be between 1 and 3, it is ${e.security}`);const t=new h.MerkleTree(e.seed,e.start,e.count,e.security);return u.TrytesHelper.fromTrits(t.root.addressTrits)},t.createMessage=function(e,t){var r;if(!u.TrytesHelper.isTrytes(t))throw new Error("The message must be in trytes");const o=new h.MerkleTree(e.seed,e.start,e.count,e.security),s=new h.MerkleTree(e.seed,e.start+e.count,e.nextCount,e.security).root.addressTrits,l=u.TrytesHelper.toTrits(t),a=T.pascalEncode(e.index),i=T.pascalEncode(l.length),d=o.getSubtree(e.index),f=new n.default.Curl(27),g=u.TrytesHelper.toTrits(null!==(r=e.sideKey)&&void 0!==r?r:"9".repeat(81));f.absorb(g,0,g.length),f.absorb(o.root.addressTrits,0,o.root.addressTrits.length);let p=H.concatenate([a,i]);f.absorb(p,0,p.length);const _=A.mask(H.concatenate([s,l]),f);p=H.concatenate([p,_]);const w=(new y.HammingDiver).search(f.rate(n.default.Curl.STATE_LENGTH),e.security,n.default.Curl.HASH_LENGTH/3,0);A.mask(w,f),p=H.concatenate([p,w]);const b=c.signature(f.rate(),d.key),E=H.concatenate(d.leaves.map((e=>e.addressTrits))),m=E.length/n.default.Curl.HASH_LENGTH,v=A.mask(H.concatenate([b,T.pascalEncode(m),E]),f);p=H.concatenate([p,v]);const S=p.length%3;0!==S&&(p=H.concatenate([p,new Int8Array(3-S).fill(0)]));const F="public"===e.mode?o.root.addressTrits:A.maskHash(o.root.addressTrits),I={payload:u.TrytesHelper.fromTrits(p),root:u.TrytesHelper.fromTrits(o.root.addressTrits),address:u.TrytesHelper.fromTrits(F)};return e.index===e.count-1?(e.start=e.nextCount+e.start,e.index=0):e.index++,e.nextRoot=u.TrytesHelper.fromTrits(s),I}})),_=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.parseMessage=void 0,t.parseMessage=function(e,t,r){const o=u.TrytesHelper.toTrits(e),s=u.TrytesHelper.toTrits(t),l=u.TrytesHelper.toTrits(null!=r?r:"9".repeat(81)),a=T.pascalDecode(o),i=a.value,d=T.pascalDecode(o.slice(a.end)),f=d.value,y=a.end+d.end,H=y+n.default.Curl.HASH_LENGTH,g=H+f,p=new n.default.Curl(27);p.absorb(l,0,l.length),p.absorb(s,0,s.length),p.absorb(o,0,y);const _=A.unmask(o.slice(y,y+n.default.Curl.HASH_LENGTH),p),w=A.unmask(o.slice(H,H+f),p),b=A.unmask(o.slice(g,g+n.default.Curl.HASH_LENGTH/3),p),E=p.rate(),m=c.checksumSecurity(E);if(0===m)throw new Error("Message Hash did not have a hamming weight of zero, security level is invalid");const v=A.unmask(o.slice(g+b.length),p);p.reset();const S=v.slice(0,m*c.PRIVATE_KEY_FRAGMENT_LENGTH),F=c.digestFromSignature(E,S);p.absorb(F,0,F.length);const I=T.pascalDecode(v.slice(m*c.PRIVATE_KEY_FRAGMENT_LENGTH)),C=I.value;let N=p.rate();if(0!==C){const e=m*c.PRIVATE_KEY_FRAGMENT_LENGTH+I.end,t=v.slice(e,e+C*n.default.Curl.HASH_LENGTH);N=h.MerkleTree.root(N,t,i)}if(u.TrytesHelper.fromTrits(N)!==t)throw new Error("Signature did not match expected root");return{nextRoot:u.TrytesHelper.fromTrits(_),message:u.TrytesHelper.fromTrits(w)}}})),w=a((function(e,t){var r=s&&s.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,s){function l(e){try{i(n.next(e))}catch(e){s(e)}}function a(e){try{i(n.throw(e))}catch(e){s(e)}}function i(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(l,a)}i((n=n.apply(e,t||[])).next())}))};function o(e,t,o,s){return r(this,void 0,void 0,(function*(){g.validateModeKey(o,s);const r="string"==typeof e?new n.default.SingleNodeClient(e):e,i=l(t,o),u=n.default.Blake2b.sum256(n.default.Converter.utf8ToBytes(i));try{const e=yield r.messagesFind(u),n=[];for(const t of e.messageIds)try{const e=yield r.message(t);n.push(e)}catch(e){}return yield a(n,t,s)}catch(e){}}))}function l(e,t){return"public"===t?e:u.TrytesHelper.fromTrits(A.maskHash(u.TrytesHelper.toTrits(e)))}function a(e,t,o){var s;return r(this,void 0,void 0,(function*(){if(e&&0!==e.length)for(const r of e)if((null===(s=r.payload)||void 0===s?void 0:s.type)===n.default.INDEXATION_PAYLOAD_TYPE&&r.payload.data){const e=n.default.Converter.hexToBytes(r.payload.data);if(e.length>100){const r=e[0],n=r>0?e.slice(1,1+r):void 0,s=e.slice(1+r),l=n?u.TrytesHelper.unpackTrytes(n):"",a=u.TrytesHelper.unpackTrytes(s);try{const e=_.parseMessage(a,t,o);return Object.assign(Object.assign({root:t},e),{tag:l})}catch(e){}}}}))}Object.defineProperty(t,"__esModule",{value:!0}),t.decodeMessages=t.mamFetchAll=t.decodeAddress=t.mamFetch=t.mamAttach=void 0,t.mamAttach=function(e,t,o){return r(this,void 0,void 0,(function*(){if(void 0!==o&&"string"!=typeof o)throw new Error("MWM and depth are no longer needed when calling mamAttach");if((o?o.length:0)>27)throw new Error("The tag length is too long");const r=o?u.TrytesHelper.packTrytes(o):void 0,s=r?r.length:0,l=u.TrytesHelper.packTrytes(t.payload),a=new Uint8Array(1+s+l.length);a[0]=s,r&&a.set(r,1),a.set(l,1+s);const i=n.default.Blake2b.sum256(n.default.Converter.utf8ToBytes(t.address)),c={payload:{type:n.default.INDEXATION_PAYLOAD_TYPE,index:n.default.Converter.bytesToHex(i),data:n.default.Converter.bytesToHex(a)}},d="string"==typeof e?new n.default.SingleNodeClient(e):e;return{message:c,messageId:yield d.messageSubmit(c)}}))},t.mamFetch=o,t.decodeAddress=l,t.mamFetchAll=function(e,t,s,l,a){return r(this,void 0,void 0,(function*(){const r="string"==typeof e?new n.default.SingleNodeClient(e):e;g.validateModeKey(s,l);const i=void 0===a?Number.MAX_VALUE:a,u=[];let c=t;do{const e=yield o(r,c,s,l);e?(u.push(e),c=e.nextRoot):c=void 0}while(c&&u.length<i);return u}))},t.decodeMessages=a})),b=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0})})),E=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0})})),m=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0})})),v=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}));return l(a((function(e,t){var r=s&&s.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),n=s&&s.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),n(p,t),n(w,t),n(_,t),n(b,t),n(E,t),n(m,t),n(v,t),n(u,t)})))}));